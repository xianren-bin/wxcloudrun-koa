import{s as j,_ as ee}from"../index-eb0c0c80.js";import{d as te}from"./index-7154c37a.js";const ae=k=>(Vue.pushScopeId("data-v-3459f525"),k=k(),Vue.popScopeId(),k),le={class:"config-box"},ne={class:"event-box"},oe={class:"event-ul"},ue=["onClick"],re=ae(()=>Vue.createElementVNode("div",{class:"clear"},null,-1)),ce={key:0,class:"event-data"},de={style:{float:"left",width:"100%"}},se={style:{overflow:"auto"}},Ve={key:0,class:"render-item"},ie={style:{color:"#ccc","margin-bottom":"8px","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},me={style:{"font-weight":"bold"}},ve={style:{color:"#1DC2CA"}},pe=Vue.defineComponent({__name:"EventConfig",props:{layer:{}},setup(k){const{layer:F}=k,m=te(),{assemblyMap:N,executeModels:I,contentlinkarr:L,selectLayers:x,selectExecute:M,layers:v,pageData:b}=j(m),e=Vue.reactive({events:Vue.reactive([]),eventData:Vue.reactive({name:"",execute:"",executeParams:[],renders:{reset:{},reinit:{},setvalue:{},show:{},hide:{},toggle:{}}}),selectExecute:Vue.reactive({id:"",transaction:!1,name:"",logable:!1,params:[],forTemplate:!1,synchronous:!1,webservice:!1,script:"",type:"",note:""})});let z=Vue.ref(-1),C=Vue.reactive({}),d=Vue.ref("excute"),E=Vue.ref(""),p=Vue.ref(!1),y=Vue.ref(!1),R=[];const f=()=>{if(!e.eventData.renders)return;const a={};for(let n in v.value)a[v.value[n].id]=!0;const l=e.eventData.renders.show;for(let n in l)a[n]||(l[n]=!1);const u=e.eventData.renders.hide;for(let n in u)a[n]||(u[n]=!1);const i=e.eventData.renders.show;for(let n in i)a[n]||(i[n]=!1);const r=e.eventData.renders.reinit;for(let n in r)a[n]||(r[n]=!1);e.eventData.renders.setvalue||(e.eventData.renders.setvalue={});const s=e.eventData.renders.setvalue;for(let n in s)a[n]||(s[n]=!1);const _=e.eventData.renders.reset,w=[];for(let n in _)a[n]?_[n]&&w.push(n):_[n]=!1;p.value=v.value.length==w.length,y.value=w.length>0&&!p.value},U=()=>{if(e.selectExecute&&e.selectExecute.id){const a=e.eventData.executeParams,l={};for(let r in a)l[a[r].id]=a[r];const u=e.selectExecute.params,i=[];for(let r in u){let s={id:u[r].id,name:u[r].name,link:""};s.id&&(l[u[r].id]&&(s.link=l[u[r].id].link),i.push(s))}e.eventData.executeParams=i}else e.eventData&&(e.eventData.executeParams=[])};Vue.watch(x,()=>{x.value[0]?(x.value[0].events||(x.value[0].events=[]),e.events=x.value[0].events):b.value.events&&(e.events=b.value.events),!e.eventData.name&&e.events[0]&&(e.eventData=e.events[0])},{immediate:!0,deep:!1}),Vue.watch(()=>e.events,()=>{C={};for(let a in e.events)C[e.events[a].name]=e.events[a]},{immediate:!1,deep:!0}),Vue.watch(()=>e.eventData,()=>{f()},{immediate:!0,deep:!1}),Vue.watch(()=>e.selectExecute.params,()=>{U()},{immediate:!1,deep:!1}),Vue.watch(()=>e.eventData.execute,a=>{e.selectExecute=m.getExecuteModel(a),U()},{immediate:!0,deep:!1});const V=Vue.computed(()=>m.eventlist(F.type)),A=Vue.computed(()=>V.value.filter(l=>!C[l.value])),O=()=>{m.addDic();try{e.eventData.execute=M.value.id}catch{}},K=()=>{const a=m.getExecuteModel(e.eventData.execute);m.openExecuteEditor(a)},q=a=>{const l=e.eventData.renders.reset;for(let u in v.value)l[v.value[u].id]=a;y.value=!1},G=(a,l)=>{e.eventData.name=a},H=(a,l)=>{z.value=l,e.eventData=a},J=(a,l)=>{e.events.splice(a,1),l.name==e.eventData.name&&(e.events[0]?e.eventData=e.events[0]:e.eventData={})},Q=()=>{let a;for(let l in V.value)if(!C[V.value[l].value]){a=V.value[l].value;break}if(a){const l=Vue.reactive({name:a,execute:"",renders:{reset:{},reinit:{},setvalue:{},hide:{},show:{},toggle:{}},valid:!1,isAsync:!1,executeParams:[]});e.events.push(l),e.eventData=l}};return(a,l)=>{const u=Vue.resolveComponent("el-dropdown-item"),i=Vue.resolveComponent("el-dropdown-menu"),r=Vue.resolveComponent("el-dropdown"),s=Vue.resolveComponent("el-divider"),_=Vue.resolveComponent("el-radio-button"),w=Vue.resolveComponent("el-radio-group"),n=Vue.resolveComponent("el-col"),h=Vue.resolveComponent("el-checkbox"),T=Vue.resolveComponent("el-row"),D=Vue.resolveComponent("el-option"),B=Vue.resolveComponent("el-select"),S=Vue.resolveComponent("el-button"),W=Vue.resolveComponent("el-form-item"),g=Vue.resolveComponent("el-table-column"),X=Vue.resolveComponent("el-input"),Y=Vue.resolveComponent("el-table"),Z=Vue.resolveComponent("el-form"),P=Vue.resolveComponent("el-tab-pane"),$=Vue.resolveComponent("el-tabs");return Vue.openBlock(),Vue.createElementBlock("div",le,[Vue.createElementVNode("div",ne,[Vue.createElementVNode("div",oe,[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(e.events,(t,o)=>(Vue.openBlock(),Vue.createBlock(r,{"split-button":"",type:e.eventData===t?"primary":"",size:"small",tabIndex:o,key:t.name,onClick:c=>H(t,o),onCommand:c=>G(c)},{dropdown:Vue.withCtx(()=>[Vue.createVNode(i,null,{default:Vue.withCtx(()=>[V.value.length>e.events.length?(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,{key:0},Vue.renderList(A.value,c=>(Vue.openBlock(),Vue.createBlock(u,{key:c.value,command:c.value},{default:Vue.withCtx(()=>[Vue.createTextVNode(Vue.toDisplayString(c.label),1)]),_:2},1032,["command"]))),128)):Vue.createCommentVNode("",!0)]),_:1})]),default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(V.value,c=>Vue.withDirectives((Vue.openBlock(),Vue.createElementBlock("div",{key:c.value},[Vue.createTextVNode(Vue.toDisplayString(c.label),1),Vue.createElementVNode("span",{class:"del-btn iconfont icon-remove",onClick:fe=>J(o,t)},null,8,ue)])),[[Vue.vShow,t.name==c.value]])),128))]),_:2},1032,["type","tabIndex","onClick","onCommand"]))),128)),Vue.withDirectives(Vue.createElementVNode("div",{class:"add-event",onClick:Q},"+",512),[[Vue.vShow,V.value.length>e.events.length]])]),re]),Vue.createVNode(s),e.eventData.name?(Vue.openBlock(),Vue.createElementBlock("div",ce,[Vue.createVNode(T,{gutter:0},{default:Vue.withCtx(()=>[Vue.createVNode(n,{span:17},{default:Vue.withCtx(()=>[Vue.createVNode(w,{modelValue:Vue.unref(d),"onUpdate:modelValue":l[0]||(l[0]=t=>Vue.isRef(d)?d.value=t:d=t),size:"small",style:{"margin-bottom":"10px"}},{default:Vue.withCtx(()=>[Vue.createVNode(_,{label:"excute"},{default:Vue.withCtx(()=>[Vue.createTextVNode("请求逻辑")]),_:1}),Vue.createVNode(_,{label:"update"},{default:Vue.withCtx(()=>[Vue.createTextVNode("更新插件")]),_:1})]),_:1},8,["modelValue"])]),_:1}),Vue.unref(d)=="update"?(Vue.openBlock(),Vue.createBlock(n,{key:0,span:7},{default:Vue.withCtx(()=>[Vue.createVNode(h,{modelValue:Vue.unref(p),"onUpdate:modelValue":l[1]||(l[1]=t=>Vue.isRef(p)?p.value=t:p=t),style:{"margin-top":"4px"},indeterminate:Vue.unref(y),onChange:q},{default:Vue.withCtx(()=>[Vue.createTextVNode("全部重置")]),_:1},8,["modelValue","indeterminate"])]),_:1})):Vue.createCommentVNode("",!0)]),_:1}),Vue.createVNode($,{modelValue:Vue.unref(d),"onUpdate:modelValue":l[4]||(l[4]=t=>Vue.isRef(d)?d.value=t:d=t),class:"event-block",type:"card"},{default:Vue.withCtx(()=>[Vue.createVNode(P,{label:"请求后台逻辑",name:"excute"},{default:Vue.withCtx(()=>[Vue.createVNode(Z,{"label-position":"right","label-width":"auto",size:"small"},{default:Vue.withCtx(()=>[Vue.createVNode(W,{label:"后台逻辑:","label-width":"80px"},{default:Vue.withCtx(()=>[Vue.createElementVNode("div",de,[Vue.createVNode(T,{gutter:4,style:{clear:"both"}},{default:Vue.withCtx(()=>[Vue.createVNode(n,{span:20},{default:Vue.withCtx(()=>[e.eventData.webformId?(Vue.openBlock(),Vue.createBlock(B,{key:0,filterable:"",clearable:"",modelValue:e.eventData.execute,"onUpdate:modelValue":l[2]||(l[2]=t=>e.eventData.execute=t),placeholder:"请选择",style:{width:"100%"}},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(R),t=>(Vue.openBlock(),Vue.createBlock(D,{key:t.id,value:t.id,label:t.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):(Vue.openBlock(),Vue.createBlock(B,{key:1,filterable:"",clearable:"",modelValue:e.eventData.execute,"onUpdate:modelValue":l[3]||(l[3]=t=>e.eventData.execute=t),placeholder:"请选择",style:{width:"100%"}},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(I),t=>(Vue.openBlock(),Vue.createBlock(D,{key:t.id,value:t.id,label:t.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]))]),_:1}),Vue.createVNode(n,{span:4},{default:Vue.withCtx(()=>[e.eventData.execute?(Vue.openBlock(),Vue.createBlock(S,{key:1,class:"execute-btn",type:"info",onClick:K,icon:"Edit"})):(Vue.openBlock(),Vue.createBlock(S,{key:0,class:"execute-btn",type:"info",onClick:O,icon:"Plus"}))]),_:1})]),_:1})])]),_:1}),Vue.createVNode(Y,{data:e.eventData.executeParams||[],style:{width:"100%"},size:"small"},{default:Vue.withCtx(()=>[Vue.createVNode(g,{prop:"id",label:"参数编号",width:"","show-overflow-tooltip":!0}),Vue.createVNode(g,{prop:"name",label:"参数名称",width:"90","show-overflow-tooltip":!0}),Vue.createVNode(g,{prop:"link",label:"关联变量",width:"120"},{default:Vue.withCtx(t=>[t.row.type=="1"?(Vue.openBlock(),Vue.createBlock(X,{key:0,modelValue:t.row.value,"onUpdate:modelValue":o=>t.row.value=o,placeholder:"参数值"},null,8,["modelValue","onUpdate:modelValue"])):(Vue.openBlock(),Vue.createBlock(B,{key:1,filterable:"",clearable:"",modelValue:t.row.link,"onUpdate:modelValue":o=>t.row.link=o,placeholder:"请选择",size:"small"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(L),o=>(Vue.openBlock(),Vue.createBlock(D,{value:o.id,label:o.name,key:o.id},{default:Vue.withCtx(()=>[Vue.createTextVNode(Vue.toDisplayString(o.name+"【"+o.id+"】"),1)]),_:2},1032,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]))]),_:1})]),_:1},8,["data"])]),_:1})]),_:1}),Vue.createVNode(P,{label:"更新插件",name:"update",lazy:!0},{default:Vue.withCtx(()=>[Vue.createElementVNode("div",se,[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(v),t=>(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,{key:t.id},[t.type!="layout"?Vue.withDirectives((Vue.openBlock(),Vue.createElementBlock("div",Ve,[Vue.createElementVNode("div",ie,[Vue.createElementVNode("span",me,Vue.toDisplayString(Vue.unref(N)[t.type]?Vue.unref(N)[t.type].name:"未知组件"),1),Vue.createTextVNode("["),Vue.createElementVNode("span",ve,Vue.toDisplayString(t.name),1),Vue.createTextVNode("] ")]),(Vue.openBlock(),Vue.createBlock(h,{key:e.eventData.name,modelValue:e.eventData.renders.reinit[t.id],"onUpdate:modelValue":o=>e.eventData.renders.reinit[t.id]=o,label:t.id,style:{color:"#ccc"},onChange:f},{default:Vue.withCtx(()=>[Vue.createTextVNode("[初始化]")]),_:2},1032,["modelValue","onUpdate:modelValue","label"])),(Vue.openBlock(),Vue.createBlock(h,{key:e.eventData.name,modelValue:e.eventData.renders.reset[t.id],"onUpdate:modelValue":o=>e.eventData.renders.reset[t.id]=o,label:t.id,style:{color:"#ccc"},onChange:f},{default:Vue.withCtx(()=>[Vue.createTextVNode("[重置]")]),_:2},1032,["modelValue","onUpdate:modelValue","label"])),(Vue.openBlock(),Vue.createBlock(h,{key:e.eventData.name,modelValue:e.eventData.renders.setvalue[t.id],"onUpdate:modelValue":o=>e.eventData.renders.setvalue[t.id]=o,label:t.id,style:{color:"#ccc"},onChange:f},{default:Vue.withCtx(()=>[Vue.createTextVNode("[设值]")]),_:2},1032,["modelValue","onUpdate:modelValue","label"])),(Vue.openBlock(),Vue.createBlock(h,{key:e.eventData.name,modelValue:e.eventData.renders.show[t.id],"onUpdate:modelValue":o=>e.eventData.renders.show[t.id]=o,disabled:e.eventData.renders.hide[t.id],label:t.id,style:{color:"#ccc"},onChange:f},{default:Vue.withCtx(()=>[Vue.createTextVNode("[显示]")]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","label"])),(Vue.openBlock(),Vue.createBlock(h,{key:e.eventData.name,modelValue:e.eventData.renders.hide[t.id],"onUpdate:modelValue":o=>e.eventData.renders.hide[t.id]=o,disabled:e.eventData.renders.show[t.id],label:t.id,style:{color:"#ccc"},onChange:f},{default:Vue.withCtx(()=>[Vue.createTextVNode("[隐藏]")]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","label"]))],512)),[[Vue.vShow,(t.name||"").indexOf(Vue.unref(E))>=0||(t.id||"").indexOf(Vue.unref(E))>=0]]):Vue.createCommentVNode("",!0)],64))),128))])]),_:1})]),_:1},8,["modelValue"])])):Vue.createCommentVNode("",!0)])}}});const ke=ee(pe,[["__scopeId","data-v-3459f525"]]);export{ke as E};
