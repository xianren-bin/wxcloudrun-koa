import{s as G,_ as H}from"../index-eb0c0c80.js";import{c as y}from"./method1-ab6822cd.js";import{V as K}from"./ExecuteEditor-c9d8f81b.js";import"./theme-clouds_midnight-115bd544.js";import{d as Q}from"./index-7154c37a.js";const W=s=>(Vue.pushScopeId("data-v-a515c37f"),s=s(),Vue.popScopeId(),s),X={style:{float:"left"}},Y={style:{float:"left"}},Z=W(()=>Vue.createElementVNode("div",{class:"form-item-tips"},"单位：秒（为0或空时不刷新数据）",-1)),$=Vue.defineComponent({__name:"data",props:{data:{},modelValue:{}},emits:["update:modelValue"],setup(s,{emit:_}){const{data:l,modelValue:b}=s,n=Q(),{dataSets:C,layer:B,executeModels:S,contentlinkarr:D,selectDataSet:N,selectExecute:g,layerDataMap:E}=G(n);let c=Vue.ref(""),x=[{label:"静态数据",value:"static"},{label:"业务逻辑",value:"logic"},{label:"数据集",value:"dynamic"},{label:"外部数据",value:"outside"}],V=Vue.reactive({selectDataSet:{params:[]},selectExecute:{params:[]}});Vue.watch(c,()=>{try{l.value=JSON.parse(c.value)}catch{}});let k;const m=()=>{k!==null&&clearTimeout(k),k=setTimeout(()=>{const e=l.params,a={};for(let o in e)a[e[o].id]=e[o];const d=[];let u=[];l.dataType=="dynamic"?u=V.selectDataSet.params:l.dataType=="logic"&&(u=V.selectExecute.params);for(let o in u){let r={id:u[o].id,name:u[o].name};r.id&&(a[u[o].id]&&(r.link=a[u[o].id].link),d.push(r))}l.params=d,b&&q()},10)};Vue.watch(()=>l.value,e=>{c.value=JSON.stringify(e,null,2),m()},{immediate:!0,deep:!1}),Vue.watch(()=>l.id,e=>{e?V.selectDataSet=n.getDataSetModel(e):l.params=[]},{immediate:!0,deep:!0}),Vue.watch(()=>l.execute,e=>{e?V.selectExecute=n.getExecuteModel(e):l.params=[]},{immediate:!0,deep:!1}),Vue.watch(()=>l.dataType,()=>{m()}),Vue.watch(()=>l.params,()=>{},{immediate:!1,deep:!0}),Vue.watch(()=>V.selectDataSet.params,()=>{m()},{immediate:!1,deep:!0}),Vue.watch(()=>V.selectExecute.params,()=>{m()},{immediate:!1,deep:!0});const p=Vue.computed(()=>(E.value[B.value.type]||{}).discDataSource||{}),T=n.openExecuteEditor,U=n.addDic,M=n.openDataSetEditor,P=n.addDataSet,I=n.PublicRequestData,F=()=>{P();try{l.id=N.value.id}catch{}},R=()=>{const e=n.getDataSetModel(l.id);e&&M(e)},z=()=>{U();try{l.execute=g.value.id}catch{}},L=()=>{const e=n.getExecuteModel(l.execute);e&&T(e)},O=()=>{},q=()=>{l.data_loading=!0,I({data:l,update:!0}).then(e=>{var u;let a=e.data;l.Temp_Data=a;const d=[];if((u=e.dataMeta)!=null&&u.columns){const o=e.dataMeta.columns;for(let r in o)d.push(o[r].name)}else if(y(a,"object"))for(let o in a)d.push(o);else if(y(a,"array")&&a[0]){a=a[0];for(let o in a)d.push(o)}_("update:modelValue",d),l.data_loading=!1})};return(e,a)=>{const d=Vue.resolveComponent("el-option"),u=Vue.resolveComponent("el-select"),o=Vue.resolveComponent("el-form-item"),r=Vue.resolveComponent("el-input"),f=Vue.resolveComponent("el-col"),v=Vue.resolveComponent("el-button"),w=Vue.resolveComponent("el-row"),J=Vue.resolveComponent("el-input-number"),h=Vue.resolveComponent("el-table-column"),j=Vue.resolveComponent("el-table"),A=Vue.resolveComponent("el-form");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createVNode(o,{label:"数据类型"},{default:Vue.withCtx(()=>[Vue.createVNode(u,{modelValue:e.data.dataType,"onUpdate:modelValue":a[0]||(a[0]=t=>e.data.dataType=t),placeholder:"请选择"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(x),t=>(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,{key:t.value},[p.value[t.value]||t.value=="static"&&(p.value.jsonStatic||p.value.textStatic)?(Vue.openBlock(),Vue.createBlock(d,{key:0,label:t.label,value:t.value},null,8,["label","value"])):Vue.createCommentVNode("",!0)],64))),128))]),_:1},8,["modelValue"])]),_:1}),p.value.textStatic?Vue.withDirectives((Vue.openBlock(),Vue.createBlock(r,{key:0,type:"textarea",autosize:{minRows:4},placeholder:"请输入内容",modelValue:e.data.value,"onUpdate:modelValue":a[1]||(a[1]=t=>e.data.value=t)},null,8,["modelValue"])),[[Vue.vShow,e.data.dataType=="static"]]):Vue.createCommentVNode("",!0),e.data.dataType=="static"&&p.value.jsonStatic?(Vue.openBlock(),Vue.createBlock(Vue.unref(K),{key:1,ref:"afterScript",value:Vue.unref(c),"onUpdate:value":a[2]||(a[2]=t=>Vue.isRef(c)?c.value=t:c=t),onInit:O,lang:"json",theme:"clouds_midnight",style:{width:"100%",height:"300px"}},null,8,["value"])):Vue.createCommentVNode("",!0),Vue.withDirectives(Vue.createVNode(o,{label:"业务逻辑"},{default:Vue.withCtx(()=>[Vue.createElementVNode("div",X,[Vue.createVNode(w,{gutter:4,style:{clear:"both"}},{default:Vue.withCtx(()=>[Vue.createVNode(f,{span:21},{default:Vue.withCtx(()=>[Vue.createVNode(u,{filterable:"",clearable:"",modelValue:e.data.execute,"onUpdate:modelValue":a[3]||(a[3]=t=>e.data.execute=t),placeholder:"请选择",style:{width:"100%"}},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(S),t=>(Vue.openBlock(),Vue.createBlock(d,{key:t.id,value:t.id,label:t.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),Vue.createVNode(f,{span:3},{default:Vue.withCtx(()=>[e.data.execute?(Vue.openBlock(),Vue.createBlock(v,{key:1,class:"execute-btn",type:"info",onClick:L,icon:"Edit"})):(Vue.openBlock(),Vue.createBlock(v,{key:0,class:"execute-btn",type:"info",onClick:z,icon:"Plus"}))]),_:1})]),_:1})])]),_:1},512),[[Vue.vShow,e.data.dataType=="logic"]]),Vue.withDirectives(Vue.createVNode(o,{label:"接口路径"},{default:Vue.withCtx(()=>[Vue.createVNode(r,{modelValue:e.data.url,"onUpdate:modelValue":a[4]||(a[4]=t=>e.data.url=t),placeholder:"请填写接口路径"},null,8,["modelValue"])]),_:1},512),[[Vue.vShow,e.data.dataType=="outside"]]),Vue.withDirectives(Vue.createVNode(o,{label:"数据集"},{default:Vue.withCtx(()=>[Vue.createElementVNode("div",Y,[Vue.createVNode(w,{gutter:4,style:{clear:"both"}},{default:Vue.withCtx(()=>[Vue.createVNode(f,{span:21},{default:Vue.withCtx(()=>[Vue.createVNode(u,{filterable:"",clearable:"",modelValue:e.data.id,"onUpdate:modelValue":a[5]||(a[5]=t=>e.data.id=t),placeholder:"请选择"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(C),t=>(Vue.openBlock(),Vue.createBlock(d,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),Vue.createVNode(f,{span:3},{default:Vue.withCtx(()=>[e.data.id?(Vue.openBlock(),Vue.createBlock(v,{key:1,class:"execute-btn",type:"info",onClick:R,icon:"Edit"})):(Vue.openBlock(),Vue.createBlock(v,{key:0,class:"execute-btn",type:"info",onClick:F,icon:"Plus"}))]),_:1})]),_:1})])]),_:1},512),[[Vue.vShow,e.data.dataType=="dynamic"]]),Vue.withDirectives(Vue.createVNode(o,{label:"数据刷新间隔"},{default:Vue.withCtx(()=>[Vue.createVNode(J,{"controls-position":"right","step-strictly":!0,step:1,style:{width:"224px"},min:0,modelValue:e.data.loopTime,"onUpdate:modelValue":a[6]||(a[6]=t=>e.data.loopTime=t)},null,8,["modelValue"]),Z]),_:1},512),[[Vue.vShow,e.data.dataType!="static"]]),e.data.dataType=="dynamic"||e.data.dataType=="logic"?(Vue.openBlock(),Vue.createBlock(A,{key:2,class:"basics-block","label-position":"right","label-width":"auto",size:"small"},{default:Vue.withCtx(()=>[Vue.createVNode(j,{data:e.data.params,style:{width:"100%"},size:"small"},{default:Vue.withCtx(()=>[Vue.createVNode(h,{prop:"id",label:"参数编号",width:"","show-overflow-tooltip":!0}),Vue.createVNode(h,{prop:"name",label:"参数名称",width:"90","show-overflow-tooltip":!0}),Vue.createVNode(h,{prop:"link",label:"关联变量",width:"120"},{default:Vue.withCtx(t=>[t.row.type=="1"?(Vue.openBlock(),Vue.createBlock(r,{key:0,modelValue:t.row.value,"onUpdate:modelValue":i=>t.row.value=i,placeholder:"参数值"},null,8,["modelValue","onUpdate:modelValue"])):(Vue.openBlock(),Vue.createBlock(u,{key:1,filterable:"",clearable:"",modelValue:t.row.link,"onUpdate:modelValue":i=>t.row.link=i,placeholder:"请选择",size:"small"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(D),i=>(Vue.openBlock(),Vue.createBlock(d,{value:i.id,label:i.name,key:i.id},{default:Vue.withCtx(()=>[Vue.createTextVNode(Vue.toDisplayString(i.name+"【"+i.id+"】"),1)]),_:2},1032,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]))]),_:1})]),_:1},8,["data"])]),_:1})):Vue.createCommentVNode("",!0)])}}});const ue=H($,[["__scopeId","data-v-a515c37f"]]);export{ue as U};
