import{s as A,_ as G}from"../index-eb0c0c80.js";import{c as h}from"./method1-ab6822cd.js";import{V as H}from"./ExecuteEditor-c9d8f81b.js";import"./theme-clouds_midnight-115bd544.js";import{d as K}from"./index-7154c37a.js";const Q={style:{float:"left"}},W={style:{float:"left"}},X=Vue.defineComponent({__name:"data",props:{data:{},modelValue:{}},emits:["update:modelValue"],setup(w,{emit:_}){const{data:l,modelValue:b}=w,n=K(),{dataSets:B,layer:C,executeModels:D,contentlinkarr:S,selectDataSet:g,selectExecute:x,layerDataMap:N}=A(n);let i=Vue.ref(""),E=[{label:"静态数据",value:"static"},{label:"业务逻辑",value:"logic"},{label:"数据集",value:"dynamic"},{label:"外部数据",value:"outside"}],V=Vue.reactive({selectDataSet:{params:[]},selectExecute:{params:[]}});Vue.watch(i,()=>{try{l.value=JSON.parse(i.value)}catch{}});let k;const p=()=>{k!==null&&clearTimeout(k),k=setTimeout(()=>{const e=l.params,a={};for(let o in e)a[e[o].id]=e[o];const d=[];let u=[];l.dataType=="dynamic"?u=V.selectDataSet.params:l.dataType=="logic"&&(u=V.selectExecute.params);for(let o in u){let r={id:u[o].id,name:u[o].name};r.id&&(a[u[o].id]&&(r.link=a[u[o].id].link),d.push(r))}l.params=d,b&&q()},10)};Vue.watch(()=>l.value,e=>{i.value=JSON.stringify(e,null,2),p()},{immediate:!0,deep:!1}),Vue.watch(()=>l.id,e=>{l.dataType=="dynamic"&&(e?V.selectDataSet=n.getDataSetModel(e):l.params=[])},{immediate:!0,deep:!0}),Vue.watch(()=>l.execute,e=>{l.dataType=="logic"&&(e?V.selectExecute=n.getExecuteModel(e):l.params=[])},{immediate:!0,deep:!1}),Vue.watch(()=>l.dataType,()=>{p()}),Vue.watch(()=>l.params,()=>{},{immediate:!1,deep:!0}),Vue.watch(()=>V.selectDataSet.params,()=>{p()},{immediate:!1,deep:!0}),Vue.watch(()=>V.selectExecute.params,()=>{p()},{immediate:!1,deep:!0});const s=Vue.computed(()=>(N.value[C.value.type]||{}).discDataSource||{}),T=n.openExecuteEditor,U=n.addDic,M=n.openDataSetEditor,P=n.addDataSet,F=n.PublicRequestData,R=()=>{P();try{l.id=g.value.id}catch{}},z=()=>{const e=n.getDataSetModel(l.id);e&&M(e)},L=()=>{U();try{l.execute=x.value.id}catch{}},I=()=>{const e=n.getExecuteModel(l.execute);e&&T(e)},O=()=>{},q=()=>{l.data_loading=!0,F({data:l,update:!0}).then(e=>{var u;let a=e.data;l.Temp_Data=a;const d=[];if((u=e.dataMeta)!=null&&u.columns){const o=e.dataMeta.columns;for(let r in o)d.push(o[r].name)}else if(h(a,"object"))for(let o in a)d.push(o);else if(h(a,"array")&&a[0]){a=a[0];for(let o in a)d.push(o)}_("update:modelValue",d),l.data_loading=!1})};return(e,a)=>{const d=Vue.resolveComponent("el-option"),u=Vue.resolveComponent("el-select"),o=Vue.resolveComponent("el-form-item"),r=Vue.resolveComponent("el-input"),m=Vue.resolveComponent("el-col"),f=Vue.resolveComponent("el-button"),y=Vue.resolveComponent("el-row"),v=Vue.resolveComponent("el-table-column"),J=Vue.resolveComponent("el-table"),j=Vue.resolveComponent("el-form");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createVNode(o,{label:"数据类型"},{default:Vue.withCtx(()=>[Vue.createVNode(u,{modelValue:e.data.dataType,"onUpdate:modelValue":a[0]||(a[0]=t=>e.data.dataType=t),placeholder:"请选择"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(E),t=>(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,{key:t.value},[s.value[t.value]||t.value=="static"&&(s.value.jsonStatic||s.value.textStatic)?(Vue.openBlock(),Vue.createBlock(d,{key:0,label:t.label,value:t.value},null,8,["label","value"])):Vue.createCommentVNode("",!0)],64))),128))]),_:1},8,["modelValue"])]),_:1}),s.value.textStatic?Vue.withDirectives((Vue.openBlock(),Vue.createBlock(r,{key:0,type:"textarea",autosize:{minRows:4},placeholder:"请输入内容",modelValue:e.data.value,"onUpdate:modelValue":a[1]||(a[1]=t=>e.data.value=t)},null,8,["modelValue"])),[[Vue.vShow,e.data.dataType=="static"]]):Vue.createCommentVNode("",!0),e.data.dataType=="static"&&s.value.jsonStatic?(Vue.openBlock(),Vue.createBlock(Vue.unref(H),{key:1,ref:"afterScript",value:Vue.unref(i),"onUpdate:value":a[2]||(a[2]=t=>Vue.isRef(i)?i.value=t:i=t),onInit:O,lang:"json",theme:"clouds_midnight",style:{width:"100%",height:"300px"}},null,8,["value"])):Vue.createCommentVNode("",!0),Vue.withDirectives(Vue.createVNode(o,{label:"业务逻辑"},{default:Vue.withCtx(()=>[Vue.createElementVNode("div",Q,[Vue.createVNode(y,{gutter:4,style:{clear:"both"}},{default:Vue.withCtx(()=>[Vue.createVNode(m,{span:21},{default:Vue.withCtx(()=>[Vue.createVNode(u,{filterable:"",clearable:"",modelValue:e.data.execute,"onUpdate:modelValue":a[3]||(a[3]=t=>e.data.execute=t),placeholder:"请选择",style:{width:"100%"}},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(D),t=>(Vue.openBlock(),Vue.createBlock(d,{key:t.id,value:t.id,label:t.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),Vue.createVNode(m,{span:3},{default:Vue.withCtx(()=>[e.data.execute?(Vue.openBlock(),Vue.createBlock(f,{key:1,class:"execute-btn",type:"info",onClick:I,icon:"Edit"})):(Vue.openBlock(),Vue.createBlock(f,{key:0,class:"execute-btn",type:"info",onClick:L,icon:"Plus"}))]),_:1})]),_:1})])]),_:1},512),[[Vue.vShow,e.data.dataType=="logic"]]),Vue.withDirectives(Vue.createVNode(o,{label:"接口路径"},{default:Vue.withCtx(()=>[Vue.createVNode(r,{modelValue:e.data.url,"onUpdate:modelValue":a[4]||(a[4]=t=>e.data.url=t),placeholder:"请填写接口路径"},null,8,["modelValue"])]),_:1},512),[[Vue.vShow,e.data.dataType=="outside"]]),Vue.withDirectives(Vue.createVNode(o,{label:"数据集"},{default:Vue.withCtx(()=>[Vue.createElementVNode("div",W,[Vue.createVNode(y,{gutter:4,style:{clear:"both"}},{default:Vue.withCtx(()=>[Vue.createVNode(m,{span:21},{default:Vue.withCtx(()=>[Vue.createVNode(u,{filterable:"",clearable:"",modelValue:e.data.id,"onUpdate:modelValue":a[5]||(a[5]=t=>e.data.id=t),placeholder:"请选择"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(B),t=>(Vue.openBlock(),Vue.createBlock(d,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),Vue.createVNode(m,{span:3},{default:Vue.withCtx(()=>[e.data.id?(Vue.openBlock(),Vue.createBlock(f,{key:1,class:"execute-btn",type:"info",onClick:z,icon:"Edit"})):(Vue.openBlock(),Vue.createBlock(f,{key:0,class:"execute-btn",type:"info",onClick:R,icon:"Plus"}))]),_:1})]),_:1})])]),_:1},512),[[Vue.vShow,e.data.dataType=="dynamic"]]),e.data.dataType=="dynamic"||e.data.dataType=="logic"?(Vue.openBlock(),Vue.createBlock(j,{key:2,class:"basics-block","label-position":"right","label-width":"auto",size:"small"},{default:Vue.withCtx(()=>[Vue.createVNode(J,{data:e.data.params,style:{width:"100%"},size:"small"},{default:Vue.withCtx(()=>[Vue.createVNode(v,{prop:"id",label:"参数编号",width:"","show-overflow-tooltip":!0}),Vue.createVNode(v,{prop:"name",label:"参数名称",width:"90","show-overflow-tooltip":!0}),Vue.createVNode(v,{prop:"link",label:"关联变量",width:"120"},{default:Vue.withCtx(t=>[t.row.type=="1"?(Vue.openBlock(),Vue.createBlock(r,{key:0,modelValue:t.row.value,"onUpdate:modelValue":c=>t.row.value=c,placeholder:"参数值"},null,8,["modelValue","onUpdate:modelValue"])):(Vue.openBlock(),Vue.createBlock(u,{key:1,filterable:"",clearable:"",modelValue:t.row.link,"onUpdate:modelValue":c=>t.row.link=c,placeholder:"请选择",size:"small"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(S),c=>(Vue.openBlock(),Vue.createBlock(d,{value:c.id,label:c.name,key:c.id},{default:Vue.withCtx(()=>[Vue.createTextVNode(Vue.toDisplayString(c.name+"【"+c.id+"】"),1)]),_:2},1032,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]))]),_:1})]),_:1},8,["data"])]),_:1})):Vue.createCommentVNode("",!0)])}}});const ae=G(X,[["__scopeId","data-v-3e976a5b"]]);export{ae as U};
