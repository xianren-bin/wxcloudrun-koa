import{a as appStore,s as storeToRefs,d as defineStore,b as __vitePreload,E as Encrypt,c as service,i as axios}from"../index-eb0c0c80.js";import{T as TreeToArr,c as cloneJSON,r as randomWord,e as deepAssign,_ as __variableDynamicImportRuntimeHelper,a as getPageLayerData}from"./method-240c52ff.js";import{S as SaveDataset,e as SaveExecute,D as DelExecute,f as DelDataset,G as GetDesignerComponents,g as GetComponents,s as saveWebPage,l as loadBusinesses,h as loadDict,i as loadIdge,j as getMethodTree}from"./designer-215c5a37.js";import{_}from"./lodash-3ef7b69b.js";const appData=appStore(),{userData}=storeToRefs(appData),designerStore=defineStore("designer",{state:()=>({zoomlevel:50,assembly:[],assemblyMap:{},layerDataMap:{},componentsConfigMap:{},form_id:"",fileData:{id:"",name:"",system:"",dataModel:{datas:[]},executeModel:{executes:[]},pageModelJson:"",pages:[],lockedBean:{},createTime:"",lastModifyTime:""},selectPageId:"index",History:[],historyIndex:0,selectLayers:[],moveLayer:{indexnum:0,lyrow:{},lyrows:[]},selectExecute:{},showExecuteEditor:!1,selectDataSet:{},showDataSetEditor:!1,WMPS:{y:0,x:0},mouseArea:"",showLayerPosition:!0,editorMethodMap:{loaded:!1,methodTree:[],logicApiTree:[],phtmlApiTree:[]},businesses:[],businessesTree:[],dictSelectArr:[],primarySelectArr:[],publicparam:[{name:"登录组织代码",id:"logonUser.orgCode"},{name:"登录组织名称",id:"logonUser.orgName"},{name:"登录用户编码",id:"logonUser.userCode"},{name:"登录用户名称",id:"logonUser.userName"},{name:"登录用户根组织",id:"logonUser.rootOrgCode"},{name:"登录用户角色",id:"logonUser.userRoles"},{name:"当前时间",id:"iplatform_current_time"},{name:"当前cokict/ticket",id:"iplatform_request_cookie_value"},{name:"当前ip",id:"iplatform_request_remoteaddr"},{name:"当前主机名",id:"iplatform_request_remotehost"},{name:"项目路径",id:"iplatform_current_date"},{name:"当前日期",id:"iplatform_context_path"},{name:"微信openId",id:"logonUser.openId"},{name:"微信统一ID",id:"logonUser.unionId"}],toolbar:{show:!1,top:0,left:0},nonEditable:!1,dragIndex:0,dragType:"",formParams:{},formParamMap:{},layerMap:{},NonEditable:!1,perview:!0,dragAssembly:"",predefineColors:["#ff4500","#ff8c00","#ffd700","#90ee90","#00ced1","#1e90ff","#c71585","rgba(255, 69, 0, 0.68)","rgb(255, 120, 0)","hsv(51, 100, 98)","hsva(120, 40, 94, 0.5)","hsl(181, 100%, 37%)","hsla(209, 100%, 56%, 0.73)","#c7158577"],color:["#5688EB","#55CC9E","#E8B316","#E66749","#6959EB","#FD9B4F","#6BBCDD","#586A8B"],fontFamily:[{name:"sans-serif",value:"sans-serif"},{name:"宋体",value:"SimSun"},{name:"黑体",value:"SimHei"},{name:"微软雅黑",value:"Microsoft Yahei"},{name:"微软正黑体",value:"Microsoft JhengHei"},{name:"楷体",value:"KaiTi"},{name:"新宋体",value:"NSimSun"},{name:"仿宋",value:"FangSong"},{name:"幼圆",value:"YouYuan"},{name:"隶书",value:"LiSu"},{name:"华文细黑",value:"STXihei"},{name:"华文楷体",value:"STKaiti"},{name:"华文宋体",value:"STSong"},{name:"华文仿宋",value:"STFangsong"},{name:"华文中宋",value:"STZhongsong"},{name:"华文彩云",value:"STCaiyun"},{name:"华文琥珀",value:"STHupo"},{name:"华文新魏",value:"STXinwei"},{name:"华文隶书",value:"STLiti"},{name:"华文行楷",value:"STXingkai"}],fontWeight:[{name:"normal",value:"normal"},{name:"bold",value:"bold"},{name:"bolder",value:"bolder"},{name:"lighter",value:"lighter"},{name:"100",value:"100"},{name:"200",value:"200"},{name:"300",value:"300"},{name:"400",value:"400"},{name:"500",value:"500"},{name:"600",value:"600"},{name:"700",value:"700"}],legendPosition:[{name:"顶部居中",value:"topCenter"},{name:"顶部左侧",value:"topLeft"},{name:"顶部右侧",value:"topRight"},{name:"左侧居中",value:"leftCenter"},{name:"右侧居中",value:"rightCenter"},{name:"底部居中",value:"bottomCenter"},{name:"底部左侧",value:"bottomLeft"},{name:"底部右侧",value:"bottomRight"}],labelPosition:[{name:"中间",value:"inside"},{name:"左侧",value:"insideLeft"},{name:"右侧",value:"insideRight"}],labelPosition2:[{name:"上",value:"top"},{name:"下",value:"bottom"},{name:"左",value:"left"},{name:"右",value:"right"}]}),getters:{pageData(e){let t=e.fileData.pages.find(a=>a.id==e.selectPageId);return t||(e.fileData.pages[0]?t=e.fileData.pages[0]:t={id:"index",size:"small",labelWidth:80,labelPosition:"right",name:"新建页面",col_span:24,type:"page",events:[],lyrows:[{id:"main",name:"主视图",col_span:24,lyrows:[],type:"layout",style:{}}]},t)},getPositionData:e=>t=>{let a=[];return t.indexOf("basicfunnel")>=0?a=e.labelPosition:a=e.labelPosition2,a},getselectDataSet(e){return e.selectDataSet},getselectExecute(e){return e.selectExecute},dataSets(e){return e.fileData.dataModel?e.fileData.dataModel.datas:[]},executeModels(e){return e.fileData.executeModel?e.fileData.executeModel.executes:[]},contentlinkarr(e){let t=[];this.pageData.layers?t=this.pageData.layers:this.pageData.lyrows&&(t=TreeToArr(this.pageData.lyrows));const a=[];for(let i in t){let r=t[i].type,l;if(e.layerDataMap[r]){l=e.layerDataMap[r];const m=l.OutputValue||[];for(let d in m){let n={};n.id=m[d].value.replace("${value}",t[i].id),n.name=m[d].label.replace("${label}",t[i].name),a.push(n)}}}return a},layers(e){let t=e.fileData.pages.find(i=>i.id==e.selectPageId);!t&&e.fileData.pages[0]&&(t=e.fileData.pages[0]);let a=[];return t&&t.layers?a=t.layers:t&&t.lyrows&&(a=TreeToArr(t.lyrows)),a},pageConfig(e){let t=e.fileData.pages.find(a=>a.id==e.selectPageId);return t||(e.fileData.pages[0]?t=e.fileData.pages[0]:(t={id:"index",size:"small",labelWidth:80,labelPosition:"right",config:"",name:"新建页面",col_span:24,type:"page",events:[],lyrows:[]},e.fileData.pages.push(t)),console.log(t),t)},layer(e){const t=e.selectLayers[0];if(t){let a={},i;const r=t.type;i=e.layerDataMap[r],i&&(i=JSON.parse(JSON.stringify(i)),delete i.config.data),a=t.style||a,!a.backgroundOpacity&&a.backgroundOpacity!==0&&(a.backgroundOpacity=100),a.rotate||(a.rotate=0),t.style=JSON.parse(JSON.stringify(a))}return t||{}}},actions:{showtoolbar(){this.toolbar.show=!0,this.toolbar.top=this.WMPS.y,this.toolbar.left=this.WMPS.x},hidetoolbar(){this.toolbar.show=!1,this.toolbar.top=this.WMPS.y,this.toolbar.left=this.WMPS.x},openDataSetEditor(e){this.selectDataSet=e,this.showDataSetEditor=!0},async upDateDataSet(e){const t=_.cloneDeep(e);t.webpageid=this.form_id;const{data:a}=await SaveDataset(t);t.datasetid=a;for(let i in t)this.selectDataSet[i]=t[i]},openExecuteEditor(e){this.selectExecute=e,this.showExecuteEditor=!0},async upDateExecute(e){const t=_.cloneDeep(e);t.webpageid=this.form_id;const{data:a}=await SaveExecute(t);t.executeid=a;for(let i in t)this.selectExecute[i]=t[i]},delDic(e){return DelExecute(e)},addDic(e){let t;if(e)t=cloneJSON(e),t.id="Biz_"+randomWord(!1,8),t.name=t.name+"_复制";else{const a="Biz_"+randomWord(!1,8);t={id:a,transaction:!0,name:a,logable:!0,params:new Array,forTemplate:!1,synchronous:!1,webservice:!1,script:`var resp = {};
//1，对传入参数，业务逻辑必须的数据进行校验


//2，业务逻辑


//3，返回
resp;
`,type:"script",note:""}}this.fileData.executeModel.executes||(this.fileData.executeModel.executes=[]),this.fileData.executeModel.executes.push(t),this.selectExecute=t,this.showExecuteEditor=!0},delDataset(e){return DelDataset(e)},addDataSet(e){let t;if(e)t=cloneJSON(e),t.id="ds_"+randomWord(!1,8),t.name=t.name+"_复制";else{const a="ds_"+randomWord(!1,8);t={id:a,sourceType:"SCRIPT",name:a,columns:[],type:"SINGLE",script:`
//说明
var script={};

script.sql="";

script.filters = new Array();
//返回
script;`}}this.fileData.dataModel.datas||(this.fileData.dataModel.datas=[]),this.fileData.dataModel.datas.push(t),this.selectDataSet=t,this.showDataSetEditor=!0},changeZoomlevel(e){if(e.ml){let t=this.zoomlevel;t-=e.ml,t<50?t=50:t>200&&(t=200),this.zoomlevel=t}},addHistory(){var e=this.History.length-this.historyIndex-1;e>0&&this.History.splice(this.historyIndex,e),this.History.length>50&&this.History.splice(0,1);const t=JSON.stringify(this.pageData);t!=this.History[this.historyIndex-1]&&(this.History.push(t),this.historyIndex=this.History.length-1)},revoke(){const e=this.historyIndex-1;this.History[e]&&(this.pageData=JSON.parse(this.History[e]),this.historyIndex=e,this.selectLayers=[])},redo(){const e=this.historyIndex+1;this.History[e]&&(this.pageData=JSON.parse(this.History[e]),this.historyIndex=e,this.selectLayers=[])},changeState(e){},delSelectLayer(){if(this.selectLayers.length>0){const e=this.selectLayers,t=this.pageData.layers;ElementPlus.ElMessageBox.confirm("是否确认删除选中图层？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{for(let a in e){let i=t.indexOf(e[a]);t.splice(i,1)}this.selectLayers=[]}).catch(()=>{})}},layerAlign(e){var t=this.selectLayers,a=0,i=0,r=0,l=0,m=0,d=0;for(var n in t){var s=t[n];s.style&&(!a&&a!==0&&(a=s.style.left),!i&&i!==0&&(i=s.style.left+s.style.width),!r&&r!==0&&(r=s.style.top),!l&&l!==0&&(l=s.style.top+s.style.height),a=s.style.left<a?s.style.left:a,r=s.style.top<r?s.style.top:r,l=s.style.top+s.style.height>l?s.style.top+s.style.height:l,i=s.style.left+s.style.width>i?s.style.left+s.style.width:i)}for(var n in t){var s=t[n];s.style&&(e=="top"?s.style.top=r:e=="right"?s.style.left=i-s.style.width:e=="bottom"?s.style.top=l-s.style.height:e=="left"?s.style.left=a:e=="middle"?s.style.top=m-s.style.height/2:e=="center"&&(s.style.left=d-s.style.width/2))}},updatePageData(){let e=this.fileData,t=[];t.push(this.pageData),e.pageModelJson=JSON.stringify(t)},getExecuteModel(e){return this.fileData.executeModel.executes.filter(a=>a.id==e)[0]||{}},getDataSetModel(e){return this.fileData.dataModel.datas.filter(a=>a.id==e)[0]||{}},getLayer(){return new Promise(async e=>{const t=this.selectLayers[0];if(t){let a={},i;const r=t.type;i=await this.getLayerData(r),i&&(i=JSON.parse(JSON.stringify(i)),delete i.config.data,deepAssign(t,i.config)),a=t.style||a,!a.backgroundOpacity&&a.backgroundOpacity!==0&&(a.backgroundOpacity=100),a.rotate||(a.rotate=0),t.style=JSON.parse(JSON.stringify(a))}e(t||{})})},async getLayerData(e){let t;if(this.layerDataMap[e])t=this.layerDataMap[e];else try{t=(await __variableDynamicImportRuntimeHelper(Object.assign({"../../../views/bigScreen/components/border1/layerData.js":()=>__vitePreload(()=>import("./layerData-26860161.js"),[]),"../../../views/bigScreen/components/border10/layerData.js":()=>__vitePreload(()=>import("./layerData-416965db.js"),[]),"../../../views/bigScreen/components/border11/layerData.js":()=>__vitePreload(()=>import("./layerData-1b634a45.js"),[]),"../../../views/bigScreen/components/border12/layerData.js":()=>__vitePreload(()=>import("./layerData-5c0024f0.js"),[]),"../../../views/bigScreen/components/border13/layerData.js":()=>__vitePreload(()=>import("./layerData-dde9f9f3.js"),[]),"../../../views/bigScreen/components/border2/layerData.js":()=>__vitePreload(()=>import("./layerData-53e61a70.js"),[]),"../../../views/bigScreen/components/border3/layerData.js":()=>__vitePreload(()=>import("./layerData-3f20f6a1.js"),[]),"../../../views/bigScreen/components/border4/layerData.js":()=>__vitePreload(()=>import("./layerData-792ea7be.js"),[]),"../../../views/bigScreen/components/border5/layerData.js":()=>__vitePreload(()=>import("./layerData-2a24a5c7.js"),[]),"../../../views/bigScreen/components/border6/layerData.js":()=>__vitePreload(()=>import("./layerData-706dd3fd.js"),[]),"../../../views/bigScreen/components/border7/layerData.js":()=>__vitePreload(()=>import("./layerData-00d0b893.js"),[]),"../../../views/bigScreen/components/border8/layerData.js":()=>__vitePreload(()=>import("./layerData-8baf4d9e.js"),[]),"../../../views/bigScreen/components/border9/layerData.js":()=>__vitePreload(()=>import("./layerData-40576429.js"),[]),"../../../views/bigScreen/components/chartBarBasic/layerData.js":()=>__vitePreload(()=>import("./layerData-e7f2aeff.js"),["chunks/layerData-e7f2aeff.js","chunks/store-75fc8f26.js","index-eb0c0c80.js","index-91ee7136.css","chunks/method-240c52ff.js","chunks/designer-215c5a37.js","chunks/lodash-3ef7b69b.js"]),"../../../views/bigScreen/components/chartBarCapsule/layerData.js":()=>__vitePreload(()=>import("./layerData-9a662645.js"),[]),"../../../views/bigScreen/components/chartBarMixedLineAndBar/layerData.js":()=>__vitePreload(()=>import("./layerData-0485febc.js"),["chunks/layerData-0485febc.js","chunks/store-75fc8f26.js","index-eb0c0c80.js","index-91ee7136.css","chunks/method-240c52ff.js","chunks/designer-215c5a37.js","chunks/lodash-3ef7b69b.js"]),"../../../views/bigScreen/components/chartBarNegative/layerData.js":()=>__vitePreload(()=>import("./layerData-70d459c4.js"),["chunks/layerData-70d459c4.js","chunks/store-75fc8f26.js","index-eb0c0c80.js","index-91ee7136.css","chunks/method-240c52ff.js","chunks/designer-215c5a37.js","chunks/lodash-3ef7b69b.js"]),"../../../views/bigScreen/components/chartBarStackedColumn/layerData.js":()=>__vitePreload(()=>import("./layerData-1d9a441a.js"),["chunks/layerData-1d9a441a.js","chunks/store-75fc8f26.js","index-eb0c0c80.js","index-91ee7136.css","chunks/method-240c52ff.js","chunks/designer-215c5a37.js","chunks/lodash-3ef7b69b.js"]),"../../../views/bigScreen/components/chartFunnelBasic/layerData.js":()=>__vitePreload(()=>import("./layerData-06559188.js"),["chunks/layerData-06559188.js","chunks/store-75fc8f26.js","index-eb0c0c80.js","index-91ee7136.css","chunks/method-240c52ff.js","chunks/designer-215c5a37.js","chunks/lodash-3ef7b69b.js"]),"../../../views/bigScreen/components/chartGaugeBasic/layerData.js":()=>__vitePreload(()=>import("./layerData-9749db8b.js"),["chunks/layerData-9749db8b.js","chunks/store-75fc8f26.js","index-eb0c0c80.js","index-91ee7136.css","chunks/method-240c52ff.js","chunks/designer-215c5a37.js","chunks/lodash-3ef7b69b.js"]),"../../../views/bigScreen/components/chartLineArea/layerData.js":()=>__vitePreload(()=>import("./layerData-e387972d.js"),[]),"../../../views/bigScreen/components/chartLineBasic/layerData.js":()=>__vitePreload(()=>import("./layerData-913c48c3.js"),[]),"../../../views/bigScreen/components/chartLineMultipleXAxes/layerData.js":()=>__vitePreload(()=>import("./layerData-ccc290e1.js"),["chunks/layerData-ccc290e1.js","chunks/store-75fc8f26.js","index-eb0c0c80.js","index-91ee7136.css","chunks/method-240c52ff.js","chunks/designer-215c5a37.js","chunks/lodash-3ef7b69b.js"]),"../../../views/bigScreen/components/chartLineStacked/layerData.js":()=>__vitePreload(()=>import("./layerData-6c976c1b.js"),["chunks/layerData-6c976c1b.js","chunks/store-75fc8f26.js","index-eb0c0c80.js","index-91ee7136.css","chunks/method-240c52ff.js","chunks/designer-215c5a37.js","chunks/lodash-3ef7b69b.js"]),"../../../views/bigScreen/components/chartLineStackedArea/layerData.js":()=>__vitePreload(()=>import("./layerData-b101e0fc.js"),["chunks/layerData-b101e0fc.js","chunks/store-75fc8f26.js","index-eb0c0c80.js","index-91ee7136.css","chunks/method-240c52ff.js","chunks/designer-215c5a37.js","chunks/lodash-3ef7b69b.js"]),"../../../views/bigScreen/components/chartMapBasic/layerData.js":()=>__vitePreload(()=>import("./layerData-225d43aa.js"),[]),"../../../views/bigScreen/components/chartPieBasic/layerData.js":()=>__vitePreload(()=>import("./layerData-c8bab829.js"),["chunks/layerData-c8bab829.js","chunks/store-75fc8f26.js","index-eb0c0c80.js","index-91ee7136.css","chunks/method-240c52ff.js","chunks/designer-215c5a37.js","chunks/lodash-3ef7b69b.js"]),"../../../views/bigScreen/components/chartPieDoughnut/layerData.js":()=>__vitePreload(()=>import("./layerData-288e6cb6.js"),["chunks/layerData-288e6cb6.js","chunks/store-75fc8f26.js","index-eb0c0c80.js","index-91ee7136.css","chunks/method-240c52ff.js","chunks/designer-215c5a37.js","chunks/lodash-3ef7b69b.js"]),"../../../views/bigScreen/components/chartPieHalfDoughnut/layerData.js":()=>__vitePreload(()=>import("./layerData-f720e366.js"),["chunks/layerData-f720e366.js","chunks/store-75fc8f26.js","index-eb0c0c80.js","index-91ee7136.css","chunks/method-240c52ff.js","chunks/designer-215c5a37.js","chunks/lodash-3ef7b69b.js"]),"../../../views/bigScreen/components/chartPieNightingaleRose/layerData.js":()=>__vitePreload(()=>import("./layerData-8eac3af0.js"),["chunks/layerData-8eac3af0.js","chunks/store-75fc8f26.js","index-eb0c0c80.js","index-91ee7136.css","chunks/method-240c52ff.js","chunks/designer-215c5a37.js","chunks/lodash-3ef7b69b.js"]),"../../../views/bigScreen/components/chartRadarBasic/layerData.js":()=>__vitePreload(()=>import("./layerData-7aea16d9.js"),["chunks/layerData-7aea16d9.js","chunks/store-75fc8f26.js","index-eb0c0c80.js","index-91ee7136.css","chunks/method-240c52ff.js","chunks/designer-215c5a37.js","chunks/lodash-3ef7b69b.js"]),"../../../views/bigScreen/components/chartScatterBasic/layerData.js":()=>__vitePreload(()=>import("./layerData-20fc0b6b.js"),["chunks/layerData-20fc0b6b.js","chunks/store-75fc8f26.js","index-eb0c0c80.js","index-91ee7136.css","chunks/method-240c52ff.js","chunks/designer-215c5a37.js","chunks/lodash-3ef7b69b.js"]),"../../../views/bigScreen/components/decoration10/layerData.js":()=>__vitePreload(()=>import("./layerData-3c7a5de4.js"),[]),"../../../views/bigScreen/components/decoration11/layerData.js":()=>__vitePreload(()=>import("./layerData-4aae4c56.js"),[]),"../../../views/bigScreen/components/decoration12/layerData.js":()=>__vitePreload(()=>import("./layerData-e491fcdb.js"),[]),"../../../views/bigScreen/components/decoration2/layerData.js":()=>__vitePreload(()=>import("./layerData-e53ccde8.js"),[]),"../../../views/bigScreen/components/decoration3/layerData.js":()=>__vitePreload(()=>import("./layerData-63f50bb3.js"),[]),"../../../views/bigScreen/components/decoration5/layerData.js":()=>__vitePreload(()=>import("./layerData-6dea0865.js"),[]),"../../../views/bigScreen/components/decoration6/layerData.js":()=>__vitePreload(()=>import("./layerData-d90d6067.js"),[]),"../../../views/bigScreen/components/decoration7/layerData.js":()=>__vitePreload(()=>import("./layerData-fef81955.js"),[]),"../../../views/bigScreen/components/decoration8/layerData.js":()=>__vitePreload(()=>import("./layerData-fee88454.js"),[]),"../../../views/bigScreen/components/decoration9/layerData.js":()=>__vitePreload(()=>import("./layerData-f6a805cb.js"),[]),"../../../views/bigScreen/components/digital/layerData.js":()=>__vitePreload(()=>import("./layerData-f584102c.js"),[]),"../../../views/bigScreen/components/flyline/layerData.js":()=>__vitePreload(()=>import("./layerData-f54862f9.js"),[]),"../../../views/bigScreen/components/horseRaceLamp/layerData.js":()=>__vitePreload(()=>import("./layerData-8e87196e.js"),[]),"../../../views/bigScreen/components/hyperlink/layerData.js":()=>__vitePreload(()=>import("./layerData-d2a1a639.js"),[]),"../../../views/bigScreen/components/image/layerData.js":()=>__vitePreload(()=>import("./layerData-dd52415c.js"),[]),"../../../views/bigScreen/components/loadpage/layerData.js":()=>__vitePreload(()=>import("./layerData-1fec96bf.js"),[]),"../../../views/bigScreen/components/pond/layerData.js":()=>__vitePreload(()=>import("./layerData-a978f573.js"),[]),"../../../views/bigScreen/components/ranking/layerData.js":()=>__vitePreload(()=>import("./layerData-545415a3.js"),[]),"../../../views/bigScreen/components/realtime/layerData.js":()=>__vitePreload(()=>import("./layerData-2a677e3e.js"),[]),"../../../views/bigScreen/components/scroll/layerData.js":()=>__vitePreload(()=>import("./layerData-a84945ef.js"),[]),"../../../views/bigScreen/components/select/layerData.js":()=>__vitePreload(()=>import("./layerData-6a8c8aaf.js"),[]),"../../../views/bigScreen/components/swiper/layerData.js":()=>__vitePreload(()=>import("./layerData-522cd5d6.js"),[]),"../../../views/bigScreen/components/text/layerData.js":()=>__vitePreload(()=>import("./layerData-647e026d.js"),[]),"../../../views/bigScreen/components/textswiper/layerData.js":()=>__vitePreload(()=>import("./layerData-57411afc.js"),[]),"../../../views/bigScreen/components/timefilter/layerData.js":()=>__vitePreload(()=>import("./layerData-f4a2cfcc.js"),[]),"../../../views/bigScreen/components/vectorIcon/layerData.js":()=>__vitePreload(()=>import("./layerData-da14da6a.js"),[]),"../../../views/bigScreen/components/video/layerData.js":()=>__vitePreload(()=>import("./layerData-7d184c5b.js"),[]),"../../../views/bigScreen/components/water/layerData.js":()=>__vitePreload(()=>import("./layerData-0f7d97e5.js"),[])}),`../../../views/bigScreen/components/${e}/layerData.js`)).layerData,t.code=e,t.config.type=e,t.config.name=t.name,t.config.style||(t.config.style={top:0,left:0,width:100,height:100}),t.config.style.top=t.config.style.top||0,t.config.style.left=t.config.style.left||0,this.layerDataMap[e]=t}catch{}return t},async getAssembly(e){debugger;if(!this.assembly.length)if(e==="page"){const{data:t}=await GetDesignerComponents();return this.setAssembly(t),this.assembly}else{const{data:t}=await GetComponents();debugger;return this.setAssembly(t),this.assembly}return this.assembly},setAssembly(e){const t={};for(let a in e)for(let i in e[a].list)t[e[a].list[i].code]=e[a].list[i];this.assembly=e,this.assemblyMap=t},eventlist(e){let t=this.layerDataMap[e];return t?JSON.parse(JSON.stringify(t.eventList)):[]},async addPageLayer(e){const t=e.code,a=await getPageLayerData(t);if(this.layerDataMap[t]=a,a&&a.config){const i=cloneJSON(a.config),r=randomWord(!1,8);i.id="Layer_"+r,e.lyrow&&e.lyrow.type=="layout"?i.col_span=24:e.lyrow&&e.lyrow.col_span?i.col_span=e.lyrow.col_span:i.col_span||(i.col_span=6),e.indexnum!=-1?e.lyrows.splice(e.indexnum,0,i):e.lyrows.push(i)}else ElementPlus.ElMessage({message:"未找的组件信息",type:"error",duration:5*1e3})},async addLayer(e){const t=e.code,a=await this.getLayerData(t);if(a&&a.config){const i=cloneJSON(a.config),r=randomWord(!1,8);i.id="Layer_"+r,i.name=i.name+"_"+r,i.style||(i.style={width:300,height:200,rotate:0,backgroundOpacity:100}),i.style.top=e.layerY,i.style.left=e.layerX,e.indexnum!=-1?this.pageData.layers.splice(e.indexnum,0,i):this.pageData.layers.unshift(i)}else ElementPlus.ElMessage({message:"未找的组件信息",type:"error",duration:5*1e3})},copyLayer(e){const t=this.selectLayers;for(let a in t){const i=cloneJSON(t[a]),r=randomWord(!1,8);i.id="Layer_"+r,i.name=i.name+"_"+r,i.style.top+=10,i.style.left+=10,this.pageData.layers.unshift(i)}},selectLayer(e){this.selectLayers.push(e.layer)},changeLayerIndex(e){if(this.dragIndex!=e&&e<this.pageData.layers.length){const t=this.pageData.layers[this.dragIndex];this.pageData.layers.splice(this.dragIndex,1),e!=-1&&this.pageData.layers.splice(e,0,t),this.dragIndex=e}this.toolbar.show=!1,this.selectLayers=[]},async saveWebPage(e){let t=this.fileData;if(!t.pages&&!t.pages.length)if(e=="s"){let i=[];i.push(this.pageData),t.pageModelJson=JSON.stringify(i)}else{let i=[];i.push(this.pageData),t.pages=i}const{data:a}=await saveWebPage(this.fileData);this.fileData.id=this.fileData.id||a},PublicRequestData({data:e,pager:t,update:a,webformId:i,perview:r}){return new Promise(async(l,m)=>{if(e){if(!a&&!r&&e.Temp_Data){const p={};return p.data=e.Temp_Data,l(p),!1}e=JSON.parse(JSON.stringify(e));let y="",o={};const c=JSON.parse(JSON.stringify(this.formParams)),f=e?e.dataType:null,u=e.webFormId||i;JSON.stringify(c)=="{}"&&(c.iplatform_web_form_id=u);var d=e.params||[];for(let p in d){var n=d[p],s=n.link||n.id;n.type=="1"?o[n.id]=n.value:c[s]!=null&&c[s]!=null?o[n.id]=c[s]:o[n.id]=""}if(t&&(t.page||(t.page=1),t.rows||(t.rows=15)),f=="static"){const p={};p.data=e.value,l(p)}else if(f=="logic"&&e.execute)if(this.perview)o.iplatform_web_form_id=u,o.iplatform_web_form_execute=e.execute,y="/web_execute.action";else{y="/web_queryData.action";const p=this.getExecuteModel(e.execute),h=userData.value.isi.substring(0,16);o.data=Encrypt(h,p.script),o.systemCode=this.fileData.system}else f=="outside"&&e.url?(y=e.url,o=c):f=="dynamic"&&e.id&&(y="/web_data.action",o={params:o,webFormId:this.form_id,type:"DATASET",pageData:{id:e.id,flag:"1"}},t&&(o.pager=t),this.perview?o={postData:JSON.stringify(o)}:(e.pager&&(t={},t.page||(t.page=1),t.rows||(t.rows=1),o.pager=t),o={postData:JSON.stringify(o)}));if(y){const p=await service({url:y,method:"post",data:o});let h={};h.data=p.data,p.data&&p.data.dataList&&(h=p.data,h.data=p.data.dataList),l(h)}else{const p={};p.data="",l(p)}}})},ExecuteEvent(e,t){return new Promise(async(a,i)=>{if(!this.perview)return a(!1),!1;const r={iplatform_web_form_id:e.webformId||t,iplatform_web_form_execute:e.execute},l=JSON.parse(JSON.stringify(this.formParams));var m=e.executeParams||[];for(let o in m){var d=m[o],n=d.link||d.id;d.type=="1"?r[d.id]=d.value:l[n]!=null&&l[n]!=null?r[d.id]=l[n]:r[d.id]=""}let s=await this.eventFunBefore(e),y={};if(e.execute&&!s){const o={postData:JSON.stringify(r)},c=await service({url:"/web_execute.action",method:"post",data:o});c.code==0?y=c.data:i(c.error)}if(s=await this.eventFunAfter({event:e,responeData:y}),!s){const o=e.renders.show||{};for(let u in o)o[u]&&this.layerMap[u]&&this.layerMap[u].show&&this.layerMap[u].show();const c=e.renders.hide||{};for(let u in c)c[u]&&this.layerMap[u]&&this.layerMap[u].hide&&this.layerMap[u].hide();const f=e.renders.reset||{};for(let u in f)f[u]&&this.layerMap[u]&&this.layerMap[u].initial&&this.layerMap[u].initial()}a(!0)})},eventFunAfter({event,responeData}){return new Promise((resolve,reject)=>{try{let isreturn=!1;const afterScript=event.afterScript;eval(afterScript),resolve(isreturn)}catch(e){this.handleErr(e),resolve(!0)}})},eventFunBefore(event){return new Promise((resolve,reject)=>{try{let isreturn=!1;const beforeScript=event.beforeScript;eval(beforeScript),resolve(isreturn)}catch(e){this.handleErr(e),resolve(!0)}})},handleErr(e){ElementPlus.ElMessage({message:e,type:"error",duration:5*1e3})},async GetBusinesses(){const e=await loadBusinesses(this.fileData.system),t=[];for(let a in e){let i={};if(i.code=e[a].code,i.name=e[a].name,i.type="system",e[a].models){let r=e[a].models;i.children=[];for(let l in r){let m={};if(m.code=r[l].code,m.name=r[l].name,m.type="model",m.system=e[a].code,r[l].businessObjects){let d=r[l].businessObjects;m.children=[];for(let n in d){let s={};if(s.code=d[n].code,s.name=d[n].name,s.type="object",s.system=e[a].code,d[n].attributes){let y=d[n].attributes;s.children=[];for(let o in y){let c={};c.code=y[o].code,c.name=y[o].name,c.type="attr",c.system=e[a].code,s.children.push(c)}}m.children.push(s)}}i.children.push(m)}}t.push(i)}this.$patch({businessesTree:t}),this.$patch({businesses:e})},async GetDict(){const e=await loadDict();this.$patch({dictSelectArr:e})},async GetIdge(){const e=await loadIdge();this.$patch({primarySelectArr:e})},async GetMethodtree(){if(!this.editorMethodMap.loaded){this.editorMethodMap.loaded=!0;const e={},t=await getMethodTree({type:"1",methodType:"1"});e.methodTree=t.data;const a=await getMethodTree({type:"2",methodType:"2"});e.logicApiTree=a.data;const i=await getMethodTree({type:"3",methodType:"3"});e.phtmlApiTree=i.data,e.loaded=!0,this.$patch({editorMethodMap:e})}},async unlockScreen(){if(this.fileData.lockedBean.lockedUserCode!=userData.value.userCode&&this.fileData.lockedBean.status=="1")return ElementPlus.ElMessage({message:"大屏已被"+this.fileData.lockedBean.lockedUserName+"锁定",type:"error",duration:5*1e3}),!1;var e=this.fileData.lockedBean.status=="1"?"0":"1";await service({url:"/form_changeWebformStatus.action",method:"post",data:{status:e,toolsType:"WEBFORM",form_id:this.form_id}}),this.fileData.lockedBean.status=e,this.fileData.lockedBean.lockedUserCode=userData.value.userCode},loadWebFormSource(e){axios.post("/form_queryWebFormSourceById.action",{form_id:e,form_ext:".s",storageDir:"_YS_SCREEN/_webform_/WEBFORM"}).then(t=>{let a=t.data.data;if(a.pages=a.pageModelJson?JSON.parse(a.pageModelJson):[],!a.pages.length){const r={config:{width:"1920",height:"1080",backgroundType:0,backgroundUrl:"",theme:"blue",grid:5,backgroundBlur:0,backgroundOpacity:10,backgroundColor:"",backgroundSize:"100% auto",iswatermark:!1,watermark:{}},name:"新建页面"+(this.fileData.pages.length?this.fileData.pages.length:""),remark:"",orderIndex:1,layers:[]};a.pages.push(r)}this.$patch({fileData:a});let i=a.pages[0]?a.pages[0]:{};i.config.width="1920",this.$patch({pageData:i})}).catch(t=>{})}}});export{designerStore as d};
