import{u as useLayer}from"./index-e37b0f9a.js";import{f as addUnitPx,t as transUrl,h as serializeUrl,n as number_format,i as dateFormat}from"./method-240c52ff.js";import Webform from"./index-e94d248a.js";import{_ as _export_sfc}from"../index-eb0c0c80.js";import"./designer-215c5a37.js";import"./index-7154c37a.js";import"./lodash-3ef7b69b.js";const _sfc_main$1={props:["options","label","obj","value"],data:function(){return{insidevalue:[]}},created:function(){},mounted:function(){},watch:{insidevalue:{handler:function(c){this.$set(this.obj,this.label,c.join(",")),this.$emit("change")},deep:!0},value:{handler:function(c){if(c)try{c=c.split(","),this.insidevalue=c}catch{}else this.insidevalue=[]},deep:!0,immediate:!0}},methods:{}};function _sfc_render(c,t,n,a,l,d){const p=Vue.resolveComponent("el-checkbox"),s=Vue.resolveComponent("el-checkbox-group");return Vue.openBlock(),Vue.createBlock(s,{modelValue:c.insidevalue,"onUpdate:modelValue":t[0]||(t[0]=u=>c.insidevalue=u)},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(n.options,u=>(Vue.openBlock(),Vue.createBlock(p,{key:u.code,label:u.code},{default:Vue.withCtx(()=>[Vue.createTextVNode(Vue.toDisplayString(u.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])}const elgridCheckbox=_export_sfc(_sfc_main$1,[["render",_sfc_render]]),_hoisted_1={class:"table",style:{margin:"8px"}},_hoisted_2=["innerHTML"],_hoisted_3=["onClick","title"],_hoisted_4={key:0,style:{display:"block","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},_hoisted_5=["onClick","onDblclick"],_hoisted_6=["src"],_hoisted_7=["innerHTML"],_hoisted_8=["innerHTML"],_sfc_main=Vue.defineComponent({__name:"index",props:{lyrow:{},lyrows:{},webformId:{},pageId:{}},setup(__props,{expose:__expose}){var c;const props=__props,{insidevalue,layer,perview,eventFun,RequestData,updatePatch,openDialog,getValue,getVue,windowOpen}=useLayer(props),loading=Vue.ref(!1),rowStyleMap=Vue.ref({}),customRowStyleMap=Vue.ref({}),cellStyle=(t,n)=>{var a={};return rowStyleMap.value[t]&&rowStyleMap.value[t][n]&&(rowStyleMap.value[t][n].bgColor&&(a.position="absolute",a.top="0",a.left="0",a.right="0",a.bottom="0",a.padding="6px 10px",a.margin="auto",a.background=rowStyleMap.value[t][n].bgColor),rowStyleMap.value[t][n].textColor&&(a.margin="auto",a.color=rowStyleMap.value[t][n].textColor),rowStyleMap.value[t][n].rc=="C"&&(rowStyleMap.value[t][n].fb=="B"&&(a.position="absolute",a.top="0",a.left="0",a.right="0",a.bottom="0",a.padding="6px 10px",a.margin="auto",a.background=rowStyleMap.value[t][n].bgColor||rowStyleMap.value[t][n].color),rowStyleMap.value[t][n].fb=="F"&&(a.color=rowStyleMap.value[t][n].textColor||rowStyleMap.value[t][n].color))),customRowStyleMap.value[t]&&customRowStyleMap.value[t][n]&&customRowStyleMap.value[t][n].cellStyle&&(a=customRowStyleMap.value[t][n].cellStyle),a},columnNumber=(t,n)=>{var a=number_format(t,n.decimals,n.dec_point,n.thousands_sep);return a},columnDate=(t,n)=>{var a=n.format?n.format:"YYYY-MM-DD HH:mm:ss";if(t){var l=dateFormat(a,t);return l}else return""},columnImages=(images,opts)=>{var imagesArr=new Array;if(images)try{images.indexOf("[")==0?eval("imagesArr="+images):imagesArr.push({path:images})}catch(t){}var newarr=[];for(var i in imagesArr){var datas=imagesArr[i],str=datas.path+"?_dn_="+datas.name,downLoadUrl=encodeURI(str);opts.isCache!==!1&&(str+="&add_cache=true"),newarr.push(str),datas.downLoadUrl=downLoadUrl}return newarr},columnFile=(file,opts)=>{var fileArr=new Array;if(file)try{file.indexOf("[")==0?eval("fileArr="+file):fileArr.push({path:file})}catch(t){}for(var i in fileArr){var datas=fileArr[i],str=datas.path+"?_dn_="+datas.name,downLoadUrl=encodeURI(str),imgPath="",imagetype="jpg,JPG,JPEG,GIf,PNG,jpeg,gif,png",audiotype="wav(WAV)、aif(AIF)、au(AU)、mp3(MP3)、ram(RAM)、wma(WMA)、mmf(MMF)、amr(AMR)、aac(AAC)、flac(FLAC)",ziptype="rar(RAR)、zip(ZIP,Zip)、arj(ARJ)、gz(GZ)、z(Z)",exceltype="xls,XLS,xlsx,XLSX",pdftype="pdf,PDF",ppttype="ppt,PPT,pptx,PPTX,dps,DPS",txttype="text,TEXT,txt,TXT",videotype="wmv、asf、asx,Real Player ：rm、 rmvb,mpg、mpeg、mpe,3gp,mov,mp4、m4v,avi、dat、mkv、flv、vob",wordtype="DOC,doc,DOCX,docx",ext=datas.ext?datas.ext.replace(".",""):"null";imagetype.indexOf(ext)>-1?(imgPath=datas.path,opts.isCache!==!1&&(imgPath+="?add_cache=true")):audiotype.indexOf(ext)>-1?imgPath="/resources/images/audio.png":ziptype.indexOf(ext)>-1?imgPath="/resources/images/zip.png":exceltype.indexOf(ext)>-1?imgPath="/resources/images/excel.png":pdftype.indexOf(ext)>-1?imgPath="/resources/images/pdf.png":ppttype.indexOf(ext)>-1?imgPath="/resources/images/ppt.png":txttype.indexOf(ext)>-1?imgPath="/resources/images/txt.png":wordtype.indexOf(ext)>-1?imgPath="/resources/images/word.png":videotype.indexOf(ext)>-1?imgPath="/resources/images/video.png":imgPath="/resources/images/Unknown.png",datas.imgPath=imgPath,datas.downLoadUrl=downLoadUrl}return fileArr},columnProgress=(t,n)=>{var a=t,l=new RegExp(/^[1-9]\d*\.\d*|0\.\d*[1-9]\d+%$/),d=l.test(a);return d&&(a=a.replace("%",""),a=a*100),a=a-0,a},columnExpression=(row,columnData,colOption,key)=>{if(row=JSON.parse(JSON.stringify(row)),colOption.expression)try{eval(colOption.expression)}catch(t){}return columnData},loaddown=t=>{window.open(t)},clickColumn=(t,n,a)=>{const l={};l[layer.label+"_selected_row"]=JSON.stringify(n),updatePatch(l);var d=a.opts;if(a.opts.columnEventInfo&&typeof a.opts.columnEventInfo=="object"&&(d=a.opts.columnEventInfo),t.type=="default")if(t.confirm)ElementPlus.ElMessageBox.confirm(t.confirmContent?t.confirmContent+"？":"您是否确认"+t.name+"？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{eventFun(d,a).then(()=>{}).catch(()=>{})}).catch(()=>{});else{if(t.iframe&&t.url){let s=transUrl(t.url),u=n||{};u=JSON.parse(JSON.stringify(u));let m;if(t.isCustom){let g=t.selected,f={};for(let V in g)f[g[V].id]=u[g[V].id];let y=t.customParam;for(let V in y)f[y[V]]=u[y[V]];m=serializeUrl(f)}else m=serializeUrl(u);s.indexOf("?")==-1?s=s+"?"+m:s=s+"&"+m,windowOpen(s)}eventFun(d,a).then(()=>{}).catch(()=>{})}else if(t.type=="dialog")if(t.confirm)ElementPlus.ElMessageBox.confirm(t.confirmContent?t.confirmContent+"？":"您是否确认"+(t.name||"操作")+"？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{var s=t.target.replace("layer_","");openDialog(s,t,n,!0).then(u=>{eventFun(d,a).then(()=>{}).catch(()=>{})}).catch(()=>{})}).catch(()=>{});else{var p=t.target.replace("layer_","");openDialog(p,t,n,!0).then(s=>{eventFun(d,a).then(()=>{}).catch(()=>{})}).catch(()=>{})}},columnEvent=(opts,type,row)=>{if(ElementPlus.ElMessage,opts.eventType==type)try{eval(opts.script)}catch(t){}},radioValue=Vue.computed({get(){return insidevalue.value?JSON.parse(insidevalue.value):{}},set(t){insidevalue.value=JSON.stringify(t)}}),checkValue=Vue.computed({get(){return insidevalue.value?JSON.parse(insidevalue.value):[]},set(t){insidevalue.value=JSON.stringify(t)}}),tableRef=Vue.ref(),tableData=Vue.ref([]),total=Vue.ref(100),currentPage=Vue.ref(1),pageSizes=Vue.ref([10,15,30,50,100,500,1e3]),pageSize=Vue.ref(15),handlePageChange=t=>{currentPage.value=t,initial()},handleSizeChange=t=>{pageSize.value=t,initial()},handleCurrentChange=t=>{radioValue.value=t,eventFun("radioValueChanged")},handleSelectionChange=t=>{checkValue.value=t,eventFun("checkValueChanged")};pageSize.value=(c=layer.data)==null?void 0:c.pager.rows;const initial=async()=>{var l;let t;((l=layer.data)==null?void 0:l.pager.mode)!=="nopage"&&(t={page:currentPage.value,rows:pageSize.value}),loading.value=!0;const{data:n,dataMeta:a}=await RequestData(t);loading.value=!1,total.value=a==null?void 0:a.pagination.totalRecords,tableData.value=n};return __expose({initial}),(t,n)=>{var k;const a=Vue.resolveComponent("el-button"),l=Vue.resolveComponent("el-table-column"),d=Vue.resolveComponent("el-image"),p=Vue.resolveComponent("el-input"),s=Vue.resolveComponent("el-radio"),u=Vue.resolveComponent("el-radio-group"),m=Vue.resolveComponent("el-option"),g=Vue.resolveComponent("el-select"),f=Vue.resolveComponent("el-progress"),y=Vue.resolveComponent("el-date-picker"),V=Vue.resolveComponent("el-time-picker"),_=Vue.resolveComponent("el-pagination");return Vue.openBlock(),Vue.createElementBlock("div",_hoisted_1,[Vue.unref(layer).hideHeader?Vue.createCommentVNode("",!0):(Vue.openBlock(),Vue.createElementBlock("div",{key:0,class:Vue.normalizeClass(["table-title",{"table-noborder":Vue.unref(layer).noBorder}])},[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(layer).name)+" ",1),Vue.createVNode(a,{icon:"Refresh",type:"primary",text:"",size:"small",onClick:initial}),Vue.unref(layer).showDownload?(Vue.openBlock(),Vue.createBlock(a,{key:0,icon:"Download",type:"primary",text:"",size:"small"})):Vue.createCommentVNode("",!0),Vue.unref(layer).showDel?(Vue.openBlock(),Vue.createBlock(a,{key:1,icon:"Delete",type:"primary",text:"",size:"small"})):Vue.createCommentVNode("",!0),Vue.unref(layer).showAdd?(Vue.openBlock(),Vue.createBlock(a,{key:2,icon:"Plus",type:"primary",text:"",size:"small"})):Vue.createCommentVNode("",!0)],2)),Vue.createVNode(Vue.unref(ElementPlus.ElTable),{ref_key:"tableRef",ref:tableRef,data:tableData.value,stripe:"",border:!Vue.unref(layer).noBorder,loading:loading.value,rowstyle:"rowStyleFun","highlight-current-row":Vue.unref(layer).checkable=="radio",style:{width:"100%"},onCurrentChange:handleCurrentChange,onSelectionChange:handleSelectionChange},{default:Vue.withCtx(()=>{var h,w;return[Vue.unref(layer).hideOrder?Vue.createCommentVNode("",!0):(Vue.openBlock(),Vue.createBlock(l,{key:0,fixed:"","class-name":"index",type:"index",width:"30",label:"#"})),Vue.unref(layer).checkable=="check"?(Vue.openBlock(),Vue.createBlock(l,{key:1,fixed:"",type:"selection",width:"30"})):Vue.createCommentVNode("",!0),(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(((h=Vue.unref(layer).data)==null?void 0:h.columns)||[],e=>(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,null,[e.hide?Vue.createCommentVNode("",!0):(Vue.openBlock(),Vue.createBlock(l,{key:0,prop:e.key,fixed:e.fixed,sortable:e.order,label:e.value,width:e.width,"show-overflow-tooltip":!0},{default:Vue.withCtx(o=>[Vue.createElementVNode("div",{class:Vue.normalizeClass({"nowrap-box":!Vue.unref(layer).textwrap}),style:Vue.normalizeStyle(cellStyle(e.key,o.row[e.key]))},[!e.opts||e.opts.display=="text"?(Vue.openBlock(),Vue.createElementBlock("div",{key:0,class:Vue.normalizeClass({nowrap:!Vue.unref(layer).textwrap,textwrap:Vue.unref(layer).textwrap}),innerHTML:o.row[e.key]},null,10,_hoisted_2)):e.opts.display=="number"?(Vue.openBlock(),Vue.createElementBlock("div",{key:1,class:Vue.normalizeClass({nowrap:!Vue.unref(layer).textwrap,textwrap:Vue.unref(layer).textwrap})},Vue.toDisplayString(columnNumber(o.row[e.key],e.opts)),3)):e.opts.display=="datetime"?(Vue.openBlock(),Vue.createElementBlock("div",{key:2,class:Vue.normalizeClass({nowrap:!Vue.unref(layer).textwrap,textwrap:Vue.unref(layer).textwrap})},Vue.toDisplayString(columnDate(o.row[e.key],e.opts)),3)):e.opts.display=="image"?(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,{key:3},Vue.renderList(columnImages(o.row[e.key],e.opts),r=>(Vue.openBlock(),Vue.createBlock(d,{key:r,style:Vue.normalizeStyle([{width:Vue.unref(addUnitPx)(e.opts.width),height:Vue.unref(addUnitPx)(e.opts.height),display:e.opts.iswrap?"block":"inline-block"},{margin:"5px"}]),src:r,"preview-src-list":columnImages(o.row[e.key],e.opts)},null,8,["style","src","preview-src-list"]))),128)):e.opts.display=="file"?(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,{key:4},Vue.renderList(columnFile(o.row[e.key],e.opts),(r,v)=>(Vue.openBlock(),Vue.createElementBlock("a",{key:r.imgPath+v,onClick:x=>loaddown(r.downLoadUrl),title:r.name,style:Vue.normalizeStyle([{"text-align":"center",margin:"0 5px"},{display:e.opts.iswrap?"block":"inline-block"}])},[(Vue.openBlock(),Vue.createBlock(d,{key:r.imgPath+v,style:Vue.normalizeStyle({width:Vue.unref(layer).textwrap?"40px":"20px",height:Vue.unref(layer).textwrap?"40px":"20px"}),src:r.imgPath},null,8,["style","src"])),Vue.unref(layer).textwrap?(Vue.openBlock(),Vue.createElementBlock("div",_hoisted_4,Vue.toDisplayString(r.name),1)):Vue.createCommentVNode("",!0)],12,_hoisted_3))),128)):e.opts.display=="link"?(Vue.openBlock(),Vue.createBlock(a,{key:5,type:"text",onClick:r=>clickColumn(e.opts,o.row,e)},{default:Vue.withCtx(()=>[Vue.createTextVNode(Vue.toDisplayString(o.row[e.key]),1)]),_:2},1032,["onClick"])):e.opts.display=="dynamic"?(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,{key:6},[],64)):e.opts.display=="component"?(Vue.openBlock(),Vue.createElementBlock("div",{key:7,onClick:r=>columnEvent(e.opts,"click",o.row),onDblclick:r=>columnEvent(e.opts,"dblclick",o.row)},[e.opts.component=="text"?(Vue.openBlock(),Vue.createBlock(p,{key:0,onChange:r=>columnEvent(e.opts,"change",o.row),modelValue:o.row[e.key],"onUpdate:modelValue":r=>o.row[e.key]=r},null,8,["onChange","modelValue","onUpdate:modelValue"])):Vue.createCommentVNode("",!0),e.opts.component=="radio"?(Vue.openBlock(),Vue.createBlock(u,{key:1,onChange:r=>columnEvent(e.opts,"change",o.row),modelValue:o.row[e.key],"onUpdate:modelValue":r=>o.row[e.key]=r},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(e.opts.options,r=>(Vue.openBlock(),Vue.createBlock(s,{key:r.code,label:r.code},{default:Vue.withCtx(()=>[Vue.createTextVNode(Vue.toDisplayString(r.name),1)]),_:2},1032,["label"]))),128))]),_:2},1032,["onChange","modelValue","onUpdate:modelValue"])):Vue.createCommentVNode("",!0),e.opts.component=="checkbox"?(Vue.openBlock(),Vue.createBlock(elgridCheckbox,{key:2,value:o.row[e.key],onChange:r=>columnEvent(e.opts,"change",o.row),options:e.opts.options,obj:o.row,label:e.key},null,8,["value","onChange","options","obj","label"])):Vue.createCommentVNode("",!0),e.opts.component=="select"?(Vue.openBlock(),Vue.createBlock(g,{key:3,"popper-append-to-body":!0,onChange:r=>columnEvent(e.opts,"change",o.row),modelValue:o.row[e.key],"onUpdate:modelValue":r=>o.row[e.key]=r,placeholder:"请选择"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(e.opts.options,r=>(Vue.openBlock(),Vue.createBlock(m,{key:r.code,label:r.name,value:r.code},null,8,["label","value"]))),128))]),_:2},1032,["onChange","modelValue","onUpdate:modelValue"])):Vue.createCommentVNode("",!0),e.opts.component=="progress"?(Vue.openBlock(),Vue.createBlock(f,{key:4,percentage:columnProgress(o.row[e.key],e.opts)},null,8,["percentage"])):Vue.createCommentVNode("",!0),e.opts.component=="textarea"?(Vue.openBlock(),Vue.createBlock(p,{key:5,onChange:r=>columnEvent(e.opts,"change",o.row),modelValue:o.row[e.key],"onUpdate:modelValue":r=>o.row[e.key]=r,type:"textarea"},null,8,["onChange","modelValue","onUpdate:modelValue"])):Vue.createCommentVNode("",!0),e.opts.component=="password"?(Vue.openBlock(),Vue.createBlock(p,{key:6,onChange:r=>columnEvent(e.opts,"change",o.row),modelValue:o.row[e.key],"onUpdate:modelValue":r=>o.row[e.key]=r,"show-password":!0},null,8,["onChange","modelValue","onUpdate:modelValue"])):Vue.createCommentVNode("",!0),e.opts.component=="datetime"?(Vue.openBlock(),Vue.createBlock(y,{key:7,onChange:r=>columnEvent(e.opts,"change",o.row),modelValue:o.row[e.key],"onUpdate:modelValue":r=>o.row[e.key]=r,type:"datetime",placeholder:"选择日期时间"},null,8,["onChange","modelValue","onUpdate:modelValue"])):Vue.createCommentVNode("",!0),e.opts.component=="date"?(Vue.openBlock(),Vue.createBlock(y,{key:8,"value-format":"yyyy-MM-dd",onChange:r=>columnEvent(e.opts,"change",o.row),modelValue:o.row[e.key],"onUpdate:modelValue":r=>o.row[e.key]=r,type:"date",placeholder:"选择日期"},null,8,["onChange","modelValue","onUpdate:modelValue"])):Vue.createCommentVNode("",!0),e.opts.component=="time"?(Vue.openBlock(),Vue.createBlock(V,{key:9,onChange:r=>columnEvent(e.opts,"change",o.row),modelValue:o.row[e.key],"onUpdate:modelValue":r=>o.row[e.key]=r,placeholder:"任意时间点"},null,8,["onChange","modelValue","onUpdate:modelValue"])):Vue.createCommentVNode("",!0)],40,_hoisted_5)):e.opts.display=="load"?(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,{key:8},[e.opts.loadType=="page"&&!e.opts.iframe?(Vue.openBlock(),Vue.createBlock(Webform,{key:0,webformid:e.opts.target,params:o.row},null,8,["webformid","params"])):(Vue.openBlock(),Vue.createElementBlock("iframe",{key:1,ref_for:!0,ref:"loadIframe"+o.$index,width:"100%",src:Vue.unref(transUrl)(e.opts.target)+"&"+Vue.unref(serializeUrl)(o.row),frameborder:"0"},null,8,_hoisted_6))],64)):e.opts.display=="expression"?(Vue.openBlock(),Vue.createElementBlock("div",{key:9,class:Vue.normalizeClass({nowrap:!Vue.unref(layer).textwrap,textwrap:Vue.unref(layer).textwrap}),innerHTML:columnExpression(o.row,o.row[e.key],e.opts,e.key)},null,10,_hoisted_7)):(Vue.openBlock(),Vue.createElementBlock("div",{key:10,innerHTML:o.row[e.key],class:Vue.normalizeClass({nowrap:!Vue.unref(layer).textwrap,textwrap:Vue.unref(layer).textwrap})},null,10,_hoisted_8))],6)]),_:2},1032,["prop","fixed","sortable","label","width"]))],64))),256)),(w=Vue.unref(layer).data)!=null&&w.editcolumns.length?(Vue.openBlock(),Vue.createBlock(l,{key:2,fixed:Vue.unref(layer).editcolumnfixed?"right":!1,label:Vue.unref(layer).editcolumnname,width:Vue.unref(layer).editcolumnwidth},{default:Vue.withCtx(()=>{var e;return[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList((e=Vue.unref(layer).data)==null?void 0:e.editcolumns,o=>(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,null,[o.hide?Vue.createCommentVNode("",!0):(Vue.openBlock(),Vue.createBlock(a,{key:o.key,icon:o.icon,iswrap:"",type:o.type,size:"small"},{default:Vue.withCtx(()=>[Vue.createTextVNode(Vue.toDisplayString(o.value),1)]),_:2},1032,["icon","type"]))],64))),256))]}),_:1},8,["fixed","label","width"])):Vue.createCommentVNode("",!0)]}),_:1},8,["data","border","loading","highlight-current-row"]),((k=Vue.unref(layer).data)==null?void 0:k.pager.mode)!="nopage"&&Vue.unref(perview)?(Vue.openBlock(),Vue.createBlock(_,{key:1,background:"",small:"",onSizeChange:handleSizeChange,onCurrentChange:handlePageChange,"current-page":currentPage.value,"page-sizes":pageSizes.value,"page-size":pageSize.value,layout:"prev, pager, next, jumper, sizes, total",total:total.value},null,8,["current-page","page-sizes","page-size","total"])):Vue.createCommentVNode("",!0)])}}}),index_vue_vue_type_style_index_0_scoped_04967a20_lang="",index=_export_sfc(_sfc_main,[["__scopeId","data-v-04967a20"]]);export{index as default};
