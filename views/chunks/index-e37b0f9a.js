import{s as storeToRefs,b as __vitePreload,_ as _export_sfc,c as service}from"../index-eb0c0c80.js";import{_ as __variableDynamicImportRuntimeHelper}from"./method-240c52ff.js";import{c as consoleStore}from"./designer-215c5a37.js";import{d as designerStore}from"./index-7154c37a.js";const _sfc_main$1=Vue.defineComponent({__name:"layerRender",props:{lyrow:{},webformId:{},pageId:{}},setup(o){const{lyrow:t,webformId:u,pageId:p}=o,f=consoleStore(),a=storeToRefs(f).windowMap.value[u+"/"+p],c=t.type,s=Vue.ref();Vue.watch(()=>s.value,i=>{if(a){if(i&&a.layerMap[t.id])for(let y in i)a.layerMap[t.id][y]=i[y];a.mountMap[t.id]&&(a.mountMap[t.id].mounted=!0)}else i&&i.initial&&i.initial()},{deep:!0}),Vue.watch(()=>t.data,()=>{a||s.value&&s.value.initial&&s.value.initial()},{deep:!0});const v=Vue.defineAsyncComponent(()=>__variableDynamicImportRuntimeHelper(Object.assign({"../components/button/index.vue":()=>__vitePreload(()=>import("./index-c134ad72.js"),["chunks/index-c134ad72.js","index-eb0c0c80.js","index-91ee7136.css","chunks/method-240c52ff.js","chunks/designer-215c5a37.js","chunks/index-7154c37a.js","chunks/lodash-3ef7b69b.js"]),"../components/checkbox/index.vue":()=>__vitePreload(()=>import("./index-b5bf7e81.js"),["chunks/index-b5bf7e81.js","index-eb0c0c80.js","index-91ee7136.css","chunks/method-240c52ff.js","chunks/designer-215c5a37.js","chunks/index-7154c37a.js","chunks/lodash-3ef7b69b.js"]),"../components/datetimepicker/index.vue":()=>__vitePreload(()=>import("./index-309bfc4f.js"),["chunks/index-309bfc4f.js","index-eb0c0c80.js","index-91ee7136.css","chunks/method-240c52ff.js","chunks/designer-215c5a37.js","chunks/index-7154c37a.js","chunks/lodash-3ef7b69b.js"]),"../components/layout/index.vue":()=>__vitePreload(()=>Promise.resolve().then(()=>index),void 0),"../components/plaintext/index.vue":()=>__vitePreload(()=>import("./index-586a0b24.js"),["chunks/index-586a0b24.js","index-eb0c0c80.js","index-91ee7136.css","chunks/method-240c52ff.js","chunks/designer-215c5a37.js","chunks/index-7154c37a.js","chunks/lodash-3ef7b69b.js"]),"../components/radio/index.vue":()=>__vitePreload(()=>import("./index-e8b26e32.js"),["chunks/index-e8b26e32.js","index-eb0c0c80.js","index-91ee7136.css","chunks/method-240c52ff.js","chunks/designer-215c5a37.js","chunks/index-7154c37a.js","chunks/lodash-3ef7b69b.js"]),"../components/select/index.vue":()=>__vitePreload(()=>import("./index-9431bc24.js"),["chunks/index-9431bc24.js","index-eb0c0c80.js","index-91ee7136.css","chunks/method-240c52ff.js","chunks/designer-215c5a37.js","chunks/index-7154c37a.js","chunks/lodash-3ef7b69b.js"]),"../components/table/index.vue":()=>__vitePreload(()=>import("./index-ad8eb0eb.js"),["chunks/index-ad8eb0eb.js","chunks/method-240c52ff.js","index-eb0c0c80.js","index-91ee7136.css","chunks/index-e94d248a.js","chunks/designer-215c5a37.js","chunks/index-7154c37a.js","chunks/lodash-3ef7b69b.js","index-c827aa05.css","index-fbe2b82f.css"]),"../components/tabs/index.vue":()=>__vitePreload(()=>import("./index-58137b35.js"),["chunks/index-58137b35.js","index-eb0c0c80.js","index-91ee7136.css","chunks/method-240c52ff.js","chunks/designer-215c5a37.js","chunks/index-7154c37a.js","chunks/lodash-3ef7b69b.js","index-cb7309a6.css"]),"../components/text/index.vue":()=>__vitePreload(()=>import("./index-cd5a7093.js"),["chunks/index-cd5a7093.js","index-eb0c0c80.js","index-91ee7136.css","chunks/method-240c52ff.js","chunks/designer-215c5a37.js","chunks/index-7154c37a.js","chunks/lodash-3ef7b69b.js"]),"../components/textarea/index.vue":()=>__vitePreload(()=>import("./index-f348395b.js"),["chunks/index-f348395b.js","index-eb0c0c80.js","index-91ee7136.css","chunks/method-240c52ff.js","chunks/designer-215c5a37.js","chunks/index-7154c37a.js","chunks/lodash-3ef7b69b.js"]),"../components/tree/index.vue":()=>__vitePreload(()=>import("./index-0b04079a.js"),["chunks/index-0b04079a.js","chunks/method-240c52ff.js","index-eb0c0c80.js","index-91ee7136.css","chunks/designer-215c5a37.js","chunks/index-7154c37a.js","chunks/lodash-3ef7b69b.js"])}),`../components/${c}/index.vue`));return(i,y)=>Vue.withDirectives((Vue.openBlock(),Vue.createBlock(Vue.unref(v),{ref_key:"childRef",ref:s,lyrow:i.lyrow,webformId:i.webformId,pageId:i.pageId,class:Vue.normalizeClass({hideTitle:i.lyrow.hideTitle})},null,8,["lyrow","webformId","pageId","class"])),[[Vue.vShow,!i.lyrow.hide]])}}),layerRender_vue_vue_type_style_index_0_scoped_8998d06c_lang="",layerRender=_export_sfc(_sfc_main$1,[["__scopeId","data-v-8998d06c"]]);function useLayer(props,angers){const consoleDa=consoleStore(),consoleData=storeToRefs(consoleDa),perview=consoleData.perview,handleErr=consoleDa.handleErr,layer=props.lyrow,lyrow=props.lyrow,lyrows=props.lyrows,initializeed=Vue.ref(!1),webformId=props.webformId,pageId=props.pageId,windowMap=consoleData.windowMap,executing=Vue.ref(!1),eventMap=Vue.ref({}),insidevalue=Vue.ref(),webform=windowMap.value[webformId+"/"+pageId];webform&&(insidevalue.value=webform.formParams[layer.id]);let updateVal=()=>{webform&&(webform.formParams[layer.id]=insidevalue.value)};if(angers&&angers.updateVal&&(updateVal=angers.updateVal),layer){var events=layer.events;for(var e in events)eventMap.value[events[e].name]=events[e]}const eventFunAfter=({event,responeData})=>new Promise(resolve=>{try{let isreturn=!1;const afterScript=event.afterScript;eval(afterScript),resolve(isreturn)}catch(o){handleErr(o),resolve(!0)}}),eventFunBefore=event=>new Promise(resolve=>{try{let isreturn=!1;const beforeScript=event.beforeScript;eval(beforeScript),resolve(isreturn)}catch(o){handleErr(o),resolve(!0)}}),ExecuteEvent=(o,t)=>new Promise(async(u,p)=>{if(!perview.value)return u(!1),!1;const f={iplatform_web_form_id:o.webformId||webformId,iplatform_web_form_execute:o.execute};let n={};t?n=JSON.parse(JSON.stringify(t)):n=webform?JSON.parse(JSON.stringify(webform.formParams)):{};var m=o.executeParams||[];for(let i in m){var a=m[i],c=a.link||a.id;a.type=="1"?f[a.id]=a.value:n[c]!=null&&n[c]!=null?f[a.id]=n[c]:f[a.id]=""}let s=await eventFunBefore(o),v={};if(o.execute&&!s){const i={postData:JSON.stringify(f)},y=await service({url:"/web_execute.action",method:"post",data:i});y.code==0?v=y.data:p(y.error)}if(s=await eventFunAfter({event:o,responeData:v}),!s&&webform){const i=o.renders.show||{};for(let r in i)i[r]&&webform.layerMap[r]&&webform.layerMap[r].show&&webform.layerMap[r].show();const y=o.renders.hide||{};for(let r in y)y[r]&&webform.layerMap[r]&&webform.layerMap[r].hide&&webform.layerMap[r].hide();const l=o.renders.reset||{};for(let r in l)l[r]&&webform.layerMap[r]&&webform.layerMap[r].reset&&webform.layerMap[r].reset();const _=o.renders.reinit||{};for(let r in _)l[r]&&webform.layerMap[r]&&webform.layerMap[r].initial&&webform.layerMap[r].initial();const h=o.renders.setvalue||{};for(let r in h)h[r]&&webform.layerMap[r]&&webform.layerMap[r].setVal?webform.layerMap[r].setVal(v[r]):insidevalue.value=v[r]}u(!0)}),eventFun=(o,t)=>new Promise((u,p)=>{if(executing.value)return!1;executing.value=!0;try{updateVal()}catch(n){Error(n.message)}const f=eventMap.value[o];f&&ExecuteEvent(f,t).then(n=>{executing.value=!1,u(null)}).catch(n=>{executing.value=!1,p()})}),PublicRequestData=({data:o,pager:t,update:u,webformId:p})=>new Promise(async f=>{if(o){if(!u&&!perview.value&&o.Temp_Data){const l={};return l.data=o.Temp_Data,f(l),!1}o=JSON.parse(JSON.stringify(o));let c="",s={};const v=webform?JSON.parse(JSON.stringify(webform.formParams)):{},i=o?o.dataType:null,y=o.webFormId||p;JSON.stringify(v)=="{}"&&(v.iplatform_web_form_id=y);var n=o.params||[];for(let l in n){var m=n[l],a=m.link||m.id;m.type=="1"?s[m.id]=m.value:v[a]!=null&&v[a]!=null?s[m.id]=v[a]:s[m.id]=""}if(t&&(t.page||(t.page=1),t.rows||(t.rows=15)),i=="static"){const l={};l.data=o.value,f(l)}else i=="logic"&&o.execute?(s.iplatform_web_form_id=y,s.iplatform_web_form_execute=o.execute,c="/web_execute.action"):i=="outside"&&o.url?(c=o.url,s=v):i=="dynamic"&&o.id&&(c="/web_data.action",s={params:s,webFormId:y,type:"DATASET",pageData:{id:o.id,flag:"1"}},t&&(s.pager=t),s={postData:JSON.stringify(s)});if(c){const l=await service({url:c,method:"post",data:s});let _={};_.data=l.data,l.data&&l.data.dataList&&(_=l.data,_.data=l.data.dataList,_.dataMeta=l.data.dataMeta),f(_)}else{const l={};l.data="",f(l)}}}),RequestData=o=>{const t=layer.data;return PublicRequestData({data:t,pager:o,webformId})},hide=()=>{layer.hide=!0},show=()=>{layer.hide=!1},reset=()=>{insidevalue.value=""},$patch=o=>{if(webform)for(let t in o)webform.formParams[t]=o[t]},updatePatch=$patch,openDialog=(o,t,u,p)=>new Promise((f,n)=>{var m,a,c;(c=(a=(m=webform.layerMap[o])==null?void 0:m.instance)==null?void 0:a.exposeProxy)!=null&&c.open&&webform.layerMap[o].instance.exposeProxy.open(t,u,p).then(()=>{f(o)})}),windowOpen=o=>{var t;if(consoleDa.consoleStore){const u={closable:!0,parentId:"",time:new Date().getTime()};if(u.id=o,o.indexOf("/f/")==0||o.indexOf("f/")){u.permissionType="p";let p=o.replace("/f/","").replace("f/","").split("?"),f=((t=p[1])==null?void 0:t.split("&"))||[];const n={};f.forEach(m=>{const a=m.split("=");n[a[0]]=a[1]}),p=p[0].split("/"),u.permissionUrl=p[0],u.linkParam=n,u.page=p[1]||"index"}else if(o.indexOf("/s/")||o.indexOf("s/")){u.permissionType="s";let p=o.replace("/s/","").replace("s/","").split("?");p=p[0].split("/"),u.page=p[1]||"index"}else u.permissionUrl=o,u.openType="iframe";consoleDa.openMenu(u)}else window.open(o)},getValue=o=>webform.formParams[o]||"",getVue=o=>webform.layerMap[o]||"",instance=Vue.getCurrentInstance(),returnmap={insidevalue,initializeed,layer,lyrow,lyrows,webformId,pageId,perview,instance,getValue,getVue,updatePatch,updateVal,$patch,RequestData,eventFun,ExecuteEvent,openDialog,windowOpen,hide,show,reset};if(layer&&layer.type!="page"&&webform){const o=layer.id,t=layer.order?layer.order-0:0;webform.orderMax=t>webform.orderMax?t:webform.orderMax,webform.orderMap[t]||(webform.orderMap[t]=[]),webform.orderMap[t].includes(layer.id)||webform.orderMap[t].push(layer.id),Vue.onMounted(()=>{webform.layerMap[o]=returnmap,webform.mountMap[o]={status:"initializeed",mounted:!1}}),Vue.onUnmounted(()=>{delete webform.layerMap[o],delete webform.mountMap[o]})}return Vue.watch(insidevalue,()=>{updateVal()}),returnmap}const _hoisted_1={key:0,class:"row-empty-block",style:{}},_sfc_main=Vue.defineComponent({name:"layout",__name:"index",props:{lyrows:{},lyrow:{},webformId:{},pageId:{}},setup(o){const{lyrows:t,lyrow:u,webformId:p,pageId:f}=o,n=designerStore(),{dragType:m,selectLayers:a,moveLayer:c,perview:s}=storeToRefs(n),{eventFun:v}=useLayer({lyrows:t,lyrow:u,webformId:p,pageId:f}),i=n.addPageLayer,y=(r,d,V)=>{const{dragAssembly:M}=storeToRefs(n);if(m.value=="assembly"&&M.value){const I=M.value;n.$patch({dragAssembly:""}),i({code:I,indexnum:d,lyrows:r,lyrow:V})}else m.value=="dragLayers"&&c.value.lyrow&&(c.value.lyrows.splice(c.value.indexnum,1),d!=-1?r.splice(d,0,c.value.lyrow):r.push(c.value.lyrow),n.$patch({moveLayer:{}}));n.$patch({selectLayers:[]})},l=r=>{n.$patch({selectLayers:[]}),r&&a.value.push(r)},_=(r,d,V)=>{n.$patch({dragType:"dragLayers"}),n.$patch({moveLayer:{lyrow:V,indexnum:d,lyrows:r}})},h=(r,d)=>{ElementPlus.ElMessageBox.confirm("是否确认删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{r.splice(d,1)}).catch(()=>{})};return(r,d)=>{const V=Vue.resolveComponent("layout"),M=Vue.resolveComponent("Delete"),I=Vue.resolveComponent("el-icon"),D=Vue.resolveComponent("el-col"),P=Vue.resolveComponent("el-row");return Vue.openBlock(),Vue.createElementBlock("div",{class:Vue.normalizeClass({dragenter:Vue.unref(a).includes(r.lyrow)}),onDrop:d[3]||(d[3]=Vue.withModifiers(w=>y(r.lyrows,-1,r.lyrow),["stop"])),onDragenter:d[4]||(d[4]=Vue.withModifiers(w=>l(r.lyrow),["stop"])),onDragover:d[5]||(d[5]=Vue.withModifiers(()=>{},["prevent"])),onClick:d[6]||(d[6]=w=>Vue.unref(v)("eventFun"))},[Vue.createVNode(P,{justify:r.lyrow.justify},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(r.lyrows,(w,g)=>(Vue.openBlock(),Vue.createBlock(D,{span:w.col_span,class:Vue.normalizeClass({inlineBlock:w.inline})},{default:Vue.withCtx(()=>[w.type=="layout"?(Vue.openBlock(),Vue.createBlock(V,{key:0,webformId:r.webformId,pageId:r.pageId,class:"designer-row",lyrow:w,lyrows:w.lyrows,onDragstart:Vue.withModifiers(b=>_(r.lyrows,g,w),["stop"]),draggable:!Vue.unref(s),onClick:Vue.withModifiers(b=>l(w),["stop"]),onDragover:d[0]||(d[0]=Vue.withModifiers(()=>{},["prevent"]))},null,8,["webformId","pageId","lyrow","lyrows","onDragstart","draggable","onClick"])):(Vue.openBlock(),Vue.createBlock(layerRender,{key:w.id,webformId:r.webformId,pageId:r.pageId,class:Vue.normalizeClass({dragenter:Vue.unref(a).includes(w)}),lyrow:w,lyrows:r.lyrows,onDragstart:Vue.withModifiers(b=>_(r.lyrows,g,w),["stop"]),draggable:!Vue.unref(s),onClick:Vue.withModifiers(b=>l(w),["stop"]),onDragenter:Vue.withModifiers(b=>l(w),["stop"]),indexnum:g,onDrop:Vue.withModifiers(b=>y(r.lyrows,g,w),["stop"]),onDragover:d[1]||(d[1]=Vue.withModifiers(()=>{},["prevent"])),show:"sellyrow != moveLayer.lyrow"},null,8,["webformId","pageId","class","lyrow","lyrows","onDragstart","draggable","onClick","onDragenter","indexnum","onDrop"])),Vue.unref(s)?Vue.createCommentVNode("",!0):(Vue.openBlock(),Vue.createElementBlock("div",{key:2,class:Vue.normalizeClass(["edit-block",{layoutdel:w.type=="layout"}]),onClick:d[2]||(d[2]=Vue.withModifiers(()=>{},["stop"]))},[Vue.createVNode(I,{onClick:b=>h(r.lyrows,g)},{default:Vue.withCtx(()=>[Vue.createVNode(M)]),_:2},1032,["onClick"])],2))]),_:2},1032,["span","class"]))),256))]),_:1},8,["justify"]),!r.lyrows.length&&r.lyrow.id!=="main"?(Vue.openBlock(),Vue.createElementBlock("div",_hoisted_1,"拖拽组建到此处")):Vue.createCommentVNode("",!0)],34)}}}),index_vue_vue_type_style_index_0_scoped_1726f47f_lang="",layout=_export_sfc(_sfc_main,[["__scopeId","data-v-1726f47f"]]),index=Object.freeze(Object.defineProperty({__proto__:null,default:layout},Symbol.toStringTag,{value:"Module"}));export{layout as l,useLayer as u};
