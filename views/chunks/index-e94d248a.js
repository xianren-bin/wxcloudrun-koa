import{s as M,_ as k}from"../index-eb0c0c80.js";import{c as v,b as P}from"./designer-215c5a37.js";import{d as I,T as x}from"./method-240c52ff.js";import{l as g,u as A}from"./index-e37b0f9a.js";import"./index-7154c37a.js";import"./lodash-3ef7b69b.js";const C=Vue.defineComponent({__name:"index",props:{formid:{},page:{},linkParam:{},pagedata:{}},setup(V){const{formid:c,page:_,linkParam:y,pagedata:l}=V;let t="",i="";if(c)t=c,i=_;else{const e=VueRouter.useRoute();t=e.params.id,i=e.params.page}let s=(l==null?void 0:l.id)||i;const m=v(),b=M(m),p=b.windowMap;m.$patch({perview:!0}),p.value[t+"/"+s]||(p.value[t+"/"+s]={layerMap:{},layerArr:[],pageData:{},formParams:{},linkParams:{},mountMap:{},orderMap:{},orderMax:0});const a=p.value[t+"/"+s],w=I();a.linkParams={...w,...y},a.formParams={...w,...y,...a.formParams},P(t,i).then(e=>{a.pageData=e.data,l&&!l.name?l.name=e.data.name:m.consoleStore||(document.title=e.data.name),a.layerArr=Vue.reactive(x(a.pageData.lyrows))});const f=a.layerMap,d=async(e=0)=>{if(e<=a.orderMax){const o=a.orderMap[e];if(o){const r=[];for(let n in o)f[o[n]]&&f[o[n]].initial&&r.push(f[o[n]].initial());try{await Promise.all(r),e++,d(e)}catch(n){console.log("初始化失败:"+n)}}else e++,d(e)}else{const o=()=>{},{eventFun:r}=A({webformId:t,lyrow:a.pageData,pageId:s},{updateVal:o});r("onloaded"),console.log("初始化完成")}},D=a.mountMap;Vue.watch(()=>D,e=>{let o=!0;const r=a.layerArr;for(let n in r)if(r[n].type!="layout"&&(!e[r[n].id]||!e[r[n].id].mounted))return o=!1,!0;o&&(console.log("开始初始化"),d())},{deep:!0});const h=Vue.reactive({});Vue.computed(()=>a.pageData.lyrows.find(e=>e.id=="main")||a.pageData.lyrows[0]),Vue.computed(()=>a.pageData.lyrows.find(e=>e.id=="footer"));const u=(e,o)=>(e.lyrows.length==1&&(e.lyrows[0].id="main",e.lyrows[0].name="主视图"),e.lyrows.find(r=>r.id==o));return(e,o)=>{const r=Vue.resolveComponent("el-form");return Vue.unref(a).pageData.id?(Vue.openBlock(),Vue.createBlock(r,{key:0,class:"indexDev",model:h,style:{"min-height":"100%",margin:"0",background:"#fff",padding:"8px","box-sizing":"border-box"},"label-width":Vue.unref(a).pageData.labelWidth,"label-position":Vue.unref(a).pageData.labelPosition,size:Vue.unref(a).pageData.size},{default:Vue.withCtx(()=>[Vue.createVNode(g,{webformId:Vue.unref(t),pageId:Vue.unref(s),lyrow:u(Vue.unref(a).pageData,"main"),lyrows:u(Vue.unref(a).pageData,"main").lyrows},null,8,["webformId","pageId","lyrow","lyrows"]),u(Vue.unref(a).pageData,"footer")?(Vue.openBlock(),Vue.createBlock(g,{key:0,class:"footer",webformId:Vue.unref(t),pageId:Vue.unref(s),lyrow:u(Vue.unref(a).pageData,"footer"),lyrows:u(Vue.unref(a).pageData,"footer").lyrows},null,8,["webformId","pageId","lyrow","lyrows"])):Vue.createCommentVNode("",!0)]),_:1},8,["model","label-width","label-position","size"])):Vue.createCommentVNode("",!0)}}});const F=k(C,[["__scopeId","data-v-9524b937"]]);export{F as default};
